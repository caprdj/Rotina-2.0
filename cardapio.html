<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Card√°pio</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="theme-color" content="#4b7bec" />
  <link rel="manifest" href="manifest.json" />
  <style>
    :root {
      --bg: #f5f5fa;
      --card: #ffffff;
      --card-bg: #ffffff;
      --primary: #4b7bec;
      --primary-soft: #eef2ff;
      --secondary: #20bf6b;
      --accent: #f7b731;
      --border: #ddd;
      --text-main: #222;
      --text-muted: #666;
      --danger: #eb3b5a;
      --pill-bg: #eef2ff;
      --radius: 14px;
      --base-font-size: 17px;
    }

    * { box-sizing: border-box; margin: 0; padding: 0;}

    html { font-size: var(--base-font-size); }

    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      max-width: 960px;
      margin: 0 auto;
      padding: 1rem 0.75rem 3rem;
      background: var(--bg);
      color: var(--text);
    }

    .app {
      max-width: 900px;
      margin: 0 auto;
      padding: 1rem;
    }

    header {
      background: var(--card);
      border-radius: var(--radius);
      padding: 1rem 1.2rem;
      margin-bottom: 1rem;
      box-shadow: 0 2px 6px rgba(0,0,0,0.06);
      display: flex;
      flex-direction: column;
      gap: 0.25rem;
    }

    header h1 {
      font-size: 1.4rem; margin-bottom: 0.1rem; }
    .subtitle { font-size: 0.8rem; color: var(--muted); margin-bottom: 0.4rem;
    }

    header p {
      margin: 0;
      color: var(--text-muted);
      font-size: 1rem;
    }

    .font-controls {
      margin-top: 0.5rem;
      display: flex;
      justify-content: flex-end;
      align-items: center;
      gap: 0.4rem;
    }

    .font-controls span {
      font-size: 0.9rem;
      color: var(--text-muted);
    }

    .font-btn {
      border-radius: 999px;
      border: 1px solid var(--border);
      background: #fff;
      padding: 0.1rem 0.6rem;
      cursor: pointer;
      font-size: 0.9rem;
    }

    .tabs {
      display: flex;
      gap: 0.5rem;
      margin-bottom: 1rem;
      overflow-x: auto;
    }

    .tab-btn {
      flex: 0 0 auto;
      min-width: auto;
      padding: 0.6rem 0.4rem;
      border-radius: 999px;
      border: 1px solid var(--border);
      background: #fff;
      font-size: 0.85rem;
      font-weight: 500;
      color: var(--text-main);
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.4rem;
      cursor: pointer;
      white-space: nowrap;
    }

    .tab-btn.active {
      background: var(--primary);
      border-color: var(--primary);
      color: #fff;
    }

    .tab-panel { display: none; }
    .tab-panel.active { display: block; }

    .card {
      background: var(--card);
      border-radius: var(--radius);
      padding: 1rem;
      box-shadow: 0 2px 6px rgba(0,0,0,0.05);
      margin-bottom: 1rem;
    }

    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 0.5rem;
      margin-bottom: 0.5rem;
    }

    .card-header h2 {
      font-size: 1.3rem;
      margin: 0;
    }

    .badge {
      padding: 0.25rem 0.6rem;
      border-radius: 999px;
      font-size: 0.85rem;
      background: var(--primary-soft);
      color: var(--primary);
      font-weight: 600;
      white-space: nowrap;
    }

    .btn {
      border-radius: 999px;
      border: 1px solid var(--primary);
      padding: 0.4rem 0.9rem;
      font-size: 0.9rem;
      font-weight: 500;
      background: #fff;
      color: var(--primary);
      cursor: pointer;
    }

    .btn.primary {
      background: var(--primary);
      color: #fff;
    }

    .btn.danger {
      border-color: var(--danger);
      color: var(--danger);
    }

    .btn.sm {
      padding: 0.25rem 0.6rem;
      font-size: 0.85rem;
    }

    .btn + .btn { margin-left: 0.5rem; }

    .toolbar {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      align-items: center;
      margin-bottom: 0.5rem;
    }

    select, input[type="text"], textarea, input[type="number"], input[type="url"] {
      width: 100%;
      padding: 0.5rem 0.6rem;
      border-radius: 8px;
      border: 1px solid var(--border);
      font-size: 0.95rem;
      font-family: inherit;
    }

    label {
      display: block;
      font-size: 0.95rem;
      margin: 0.35rem 0 0.15rem;
    }

    textarea {
      min-height: 80px;
      resize: vertical;
    }

    .field-row {
      display: flex;
      gap: 0.75rem;
      flex-wrap: wrap;
    }

    .field-row > div {
      flex: 1 1 140px;
    }

    .recipes-list {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }

    .recipe-card {
      border-radius: 10px;
      border: 1px solid var(--border);
      padding: 0.6rem 0.7rem;
      background: #fff;
      display: flex;
      flex-direction: column;
      gap: 0.3rem;
    }

    .recipe-top {
      display: flex;
      align-items: flex-start;
      gap: 0.6rem;
    }

    .recipe-photo {
      width: 64px;
      height: 64px;
      border-radius: 8px;
      object-fit: cover;
      flex-shrink: 0;
      border: 1px solid var(--border);
      cursor: pointer;
    }

    .recipe-main {
      min-width: 0;
      flex: 1;
    }

    .recipe-name {
      font-size: 1.05rem;
      font-weight: 600;
      margin-bottom: 0.2rem;
      word-wrap: break-word;
    }

    .recipe-meta {
      font-size: 0.9rem;
      color: var(--text-muted);
    }

    .recipe-link-inline {
      margin-top: 0.2rem;
      font-size: 0.9rem;
    }

    .recipe-link-inline a {
      text-decoration: underline;
    }

    .recipe-actions {
      display: flex;
      flex-wrap: wrap;
      gap: 0.3rem;
      justify-content: flex-end;
    }

    .recipe-actions .btn.sm {
      min-width: 2rem;
      text-align: center;
      padding-inline: 0.5rem;
    }

    .recipe-details {
      margin-top: 0.4rem;
      border-top: 1px dashed var(--border);
      padding-top: 0.4rem;
    }

    .recipe-details ul {
      margin: 0.25rem 0 0.4rem;
      padding-left: 1.1rem;
      font-size: 0.95rem;
    }

    .section-title {
      font-weight: 600;
      margin: 0.6rem 0 0.25rem;
      font-size: 1rem;
    }

    .small {
      font-size: 0.9rem;
      color: var(--text-muted);
    }

    .week-block { margin-top: 0.6rem; }

    .week-list {
      font-size: 0.95rem;
      color: var(--text-muted);
      margin-bottom: 0.6rem;
    }

    .week-list ul {
      margin: 0.2rem 0 0.4rem;
      padding-left: 1.1rem;
    }

    .week-list li {
      margin-bottom: 0.1rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 0.4rem;
    }

    .search-input { margin-bottom: 0.4rem; }

    .modal-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.4);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 20;
    }

    .modal-overlay.active { display: flex; }

    .modal {
      background: #fff;
      border-radius: 12px;
      max-width: 500px;
      width: calc(100% - 2rem);
      padding: 1rem;
      max-height: 80vh;
      overflow: auto;
    }

    .modal h2 {
      margin: 0 0 0.5rem;
      font-size: 1.2rem;
    }

    .modal-content { margin-bottom: 0.75rem; }
    .modal-actions { text-align: right; }

    .recipe-checkbox-list {
      list-style: none;
      padding: 0;
      margin: 0;
    }

    .recipe-checkbox-list li {
      margin-bottom: 0.3rem;
      font-size: 0.95rem;
    }

    .filter-row {
      display: flex;
      flex-wrap: wrap;
      gap: 0.4rem;
      margin-bottom: 0.5rem;
    }

    /* LISTA DE COMPRAS */
    #shoppingListContainer {
      font-size: 0.95rem;
    }

    .shopping-recipe-block {
      border-top: 1px solid var(--border);
      padding-top: 0.5rem;
      margin-top: 0.5rem;
    }

    .shopping-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 0.4rem;
      margin-bottom: 0.3rem;
    }

    .shopping-header-actions {
      display: flex;
      flex-wrap: wrap;
      gap: 0.3rem;
    }

    .shopping-recipe-block ul {
      margin: 0.2rem 0 0.4rem;
      padding-left: 0;
      list-style: none;
    }

    .shopping-recipe-block li {
      margin-bottom: 0.2rem;
      display: flex;
      align-items: center;
      gap: 0.3rem;
    }

    .shopping-recipe-block label {
      margin: 0;
      flex: 1;
      display: flex;
      align-items: center;
      gap: 0.3rem;
    }

    .shopping-recipe-block span[contenteditable="true"] {
      outline: none;
      border-radius: 4px;
      padding: 0 2px;
      min-width: 40px;
    }

    .shopping-recipe-block .btn.sm {
      padding-inline: 0.4rem;
      min-width: 2rem;
    }

    #photoOverlay .modal {
      max-width: 90vw;
      max-height: 90vh;
      padding: 0.5rem;
    }

    #photoOverlayImg {
      max-width: 100%;
      height: auto;
      display: block;
      border-radius: 12px;
    }

  /* ===== ACOMPANHAMENTO DAS REFEI√á√ïES ===== */
  .meal-status-row {
    margin-top: 0.4rem;
    font-size: 0.8rem;
  }

  .meal-status-row .small-label {
    color: var(--text-muted);
    display: block;
    margin-bottom: 0.15rem;
  }

  .meal-status-buttons {
    display: flex;
    flex-wrap: wrap;
    gap: 0.25rem;
  }

  .meal-status-buttons .status-btn {
    border-radius: 999px;
    border: 1px solid var(--border);
    background: #fff;
    padding: 0.15rem 0.6rem;
    font-size: 0.75rem;
    cursor: pointer;
    color: var(--text-muted);
  }

  .meal-status-buttons .status-btn.active {
    border-color: var(--primary);
    background: var(--primary-soft);
    color: var(--primary);
    font-weight: 600;
  }

  .stats-resumo {
    font-size: 0.9rem;
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
  }

  .stats-row {
    display: flex;
    flex-direction: column;
    gap: 0.15rem;
  }

  .stats-row .label {
    display: flex;
    justify-content: space-between;
    gap: 0.5rem;
  }

  .stats-bar {
    height: 8px;
    border-radius: 999px;
    background: #eee;
    overflow: hidden;
  }

  .stats-bar-fill {
    height: 100%;
    border-radius: 999px;
    width: 0%;
    background: var(--primary);
    transition: width 0.25s ease-out;
  }

  .stats-bar-fill.segui {
    background: var(--secondary);
  }

  .stats-bar-fill.ajustei {
    background: var(--accent);
  }

  .stats-bar-fill.pulei {
    background: var(--muted);
  }

  .stats-bar-fill.naoSegui {
    background: var(--danger);
  }

  .stats-bar-fill.semRegistro {
    background: var(--border);
  }


    @media (max-width: 600px) {
      header h1 { font-size: 1.4rem; }
      .card-header h2 { font-size: 1.1rem; }
      .recipe-name { font-size: 1rem; }
    }
.btn-home {
  display: inline-flex;
  align-items: center;
  gap: 0.35rem;
  padding: 0.35rem 0.9rem;
  border-radius: 999px;
  border: 1px solid var(--primary);
  background: transparent;
  color: var(--primary);
  font-size: 0.9rem;
  font-weight: 500;
  cursor: pointer;
}

.btn-home .icon {
  font-size: 1.0rem;
}

.btn-home:active {
  background: var(--pill-bg);
}


  
    /* Backup/Restaurar ‚Äì alinhado ao visual do Rotina */
    .top-header .top-right .btn {
      background: var(--primary-soft);
      color: var(--primary);
      border-color: rgba(75,123,236,0.35);
      font-weight: 600;
    }
    .top-header .top-right .btn:hover { filter: brightness(0.98); }

  
    /* ===== Top actions (In√≠cio / Backup / Restaurar) ===== */
    .nav-row{
      display:flex;
      gap:10px;
      align-items:center;
      flex-wrap:wrap;
      justify-content:flex-start;
    }
    .pill-btn{
      width:auto;
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:10px 14px;
      border-radius:999px;
      background:var(--pill-bg);
      border:1px solid rgba(0,0,0,.08);
      line-height:1;
      white-space:nowrap;
    }
    .pill-btn .icon{font-size:0.9em; line-height:1;}



/* === UI Pills (a√ß√µes x sele√ß√£o) === */

:root{
  --ui-accent: #4b7bec;
  --ui-soft: #eef2ff;
  --ui-shadow: 0 10px 26px rgba(0,0,0,.12);
  --ui-shadow-sm: 0 8px 18px rgba(0,0,0,.12);
}

/* =========================
   A√á√ïES (clique √∫nico)
   Ex.: In√≠cio / Backup / Restaurar / Atualizar
========================= */
.btn-pill, .pill-btn, .action-pill{
  background:#fff;
  border:2px solid var(--ui-accent);
  color:var(--ui-accent);
  border-radius:90px;
  padding:10px 14px;
  font-weight:500;
  display:inline-flex;
  align-items:center;
  justify-content:center;
  gap:8px;
  cursor:pointer;
  user-select:none;
  -webkit-tap-highlight-color: transparent;
  white-space:nowrap;
  line-height:1;
}

.btn-pill .icon, .pill-btn .icon, .action-pill .icon{
  font-size:18px;
  line-height:1;
}

.btn-pill:hover, .pill-btn:hover, .action-pill:hover{
  background:var(--ui-soft);
}
.btn-pill:active, .pill-btn:active, .action-pill:active{
  transform: translateY(1px);
}

/* Layout das barras de a√ß√µes (pills no tamanho do conte√∫do) */
.header-actions, .top-actions.nav-row, .action-row{
  display:flex;
  gap:10px;
  align-items:center;
  justify-content:center;
  flex-wrap:wrap;
}
.header-actions > button, .top-actions.nav-row > button, .action-row > button{
  flex:0 0 auto;
}
@media (max-width:420px){
  .btn-pill, .pill-btn, .action-pill{ padding:9px 10px; gap:6px; }
}

/* =========================
   SELE√á√ÉO (bot√µes selecion√°veis)
   Ex.: Alta/Baixa; Casa/Viagem/Find/Pausa; abas Sugest√µes/Receitas/Dia/Resumo/Compras
========================= */
.pill-group, .tabs, .segmented{
  background:var(--ui-soft);
  border-radius:9px;
  padding:8px;
  display:flex;
  gap:8px;
  align-items:center;
  justify-content:space-between;
  box-shadow: var(--ui-shadow);
  -webkit-tap-highlight-color: transparent;
}

/* bot√µes dentro dos grupos */
.chip, .tab-btn, .seg-btn{
  border:none;
  background:transparent;
  color: var(--text-muted, var(--muted, #666));
  border-radius:9999px;
  padding:10px 12px;
  font-weight:600;
  display:inline-flex;
  align-items:center;
  justify-content:center;
  gap:8px;
  cursor:pointer;
  user-select:none;
  white-space:nowrap;
  min-width:0;
  line-height:1;
}

/* selecionado */
.chip.active, .tab-btn.active, .seg-btn.active{
  background:#fff;
  color:var(--ui-accent);
  box-shadow: var(--ui-shadow-sm);
}

/* varia√ß√£o "pausa"/perigo */
.chip.danger{ color: var(--danger, #eb3b5a); }
.chip.danger.active{ color: var(--danger, #eb3b5a); }

.header-tabs{ margin-top:10px; }

/* Tabs do Card√°pio em 2 linhas: 3 em cima, 2 embaixo */
.tabs{
  flex-wrap:wrap;
  width:100%;
}
.tabs .tab-btn{
  flex:1 1 calc(33.333% - 8px);
}
.tabs .tab-btn:nth-child(n+4){
  flex-basis: calc(50% - 8px);
}
@media (max-width:360px){
  .tabs .tab-btn{ padding:9px 10px; }
}


/* Se a tela for estreita demais, encurta sem quebrar a linha */
.btn-pill, .pill-btn, .action-pill{
  overflow:hidden;
  text-overflow:ellipsis;
}

</style>
</head>
<body>
  <div class="app">
    <header class="top-header">
  <div>
    <h1>Card√°pio</h1>
    <div class="subtitle">
      Sugest√µes de refei√ß√£o respeitando glicemia e inflama√ß√£o.
    </div>
  </div>

  <div class="top-actions nav-row">
    <button type="button" class="btn pill-btn" onclick="window.location.href='index.html'" title="In√≠cio">
      <span class="icon">üè†</span> In√≠cio
    </button>
    <button id="btnBackupExport" class="btn pill-btn" type="button" title="Baixar um arquivo com seus dados">
      <span class="icon">üì§</span> Backup
    </button>
    <button id="btnBackupImport" class="btn pill-btn" type="button" title="Restaurar dados a partir de um arquivo">
      <span class="icon">üì•</span> Restaurar
    </button>
    <input id="backupFile" type="file" accept="application/json" style="display:none" />
  </div>
<div class="tabs header-tabs">
  <button class="tab-btn active" data-tab="tabSugestoes">‚ú® Sugest√µes</button>
  <button class="tab-btn" data-tab="tabReceitas">üìñ Receitas</button>
  <button class="tab-btn" data-tab="tabSemana">üìÖ Dia</button>
  <button class="tab-btn" data-tab="tabResumo">üìä Resumo</button>
  <button class="tab-btn" data-tab="tabCompras">üõí Lista de compras</button>
</div>
</header>

<!-- TAB SUGEST√ïES -->
<section id="tabSugestoes" class="tab-panel active">
  <div class="card">
    <div class="card-header">
      <h2>Sugest√µes de card√°pio</h2>
</div>

    <p class="small" id="suggestContextText">
      Usando: Dia 1 (Seg) ‚Ä¢ üçõ Almo√ßo
    </p>

    <div class="toolbar">
  <div style="min-width:150px;">
    <label class="small" for="suggestProtein">Prote√≠na principal</label>
<select id="suggestProtein">
  <option value="tanto-faz">Tanto faz</option>
  <option value="frango">üçó Frango</option>
  <option value="boi">ü•© Boi</option>
  <option value="porco">üêñ Porco</option>
  <option value="peixe">üêü Peixe</option>
  <option value="ovo">ü•ö Ovo</option>
  <option value="latic√≠neos">üßÄ Latic√≠neos</option>
  <option value="veg">ü•¶ Veg</option>
</select>

  </div>

  <div style="min-width:150px;">
            <label for="suggestWork">Tipo de refei√ß√£o</label>
        <select id="suggestWork">
          <option value="tanto-faz">Tanto faz</option>
          <option value="principal">üçΩ Refei√ß√£o principal</option>
          <option value="cafe">‚òï Caf√©</option>
          <option value="sobremesa">üç∞ Sobremesa</option>
          <option value="lanche">‚òÄÔ∏è Lanche</option>
          <option value="ceia">üåí Ceia</option>
          <option value="petisco">üç∑ Petisco</option>
        
      <option value="saladas">ü•ó Saladas</option>
      <option value="molhos">ü•£ Molhos</option>
      <option value="temperos">üßÇ Temperos</option>
</select>


  </div>

  <div style="min-width:150px;">
    <label class="small" for="suggestKind">Tipo de receita</label>
    <select id="suggestKind">
      <option value="tanto-faz">Tanto faz</option>
      <option value="salgado">Salgado</option>
      <option value="doce">Doce</option>
    </select>
  </div>
</div>


    <div class="toolbar">
  <label class="small">
    <input type="checkbox" id="suggestFavOnly" />
    ‚≠ê Priorizar favoritas
  </label>
  <label class="small">
    <input type="checkbox" id="suggestAvoidRecent" checked />
    üîÅ Evitar repetir √∫ltimos dias
  </label>
</div>

<div style="margin-top:0.5rem; display:flex; flex-wrap:wrap; gap:0.5rem;">
  <button class="btn" id="btnMostrarTudo" type="button">‚ú®Filtrar</button>
  <button class="btn sm" id="btnVisitasEmCasa">üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Visitas</button>
  <button class="btn sm" id="btnTenhoIngredientes">üß∫ Tenho esses ingredientes</button>
  <button class="btn primary" id="btnGerarSugestoes">ü™Ñ Sugerir</button>
</div>

<div id="suggestionsContainer" style="margin-top:0.75rem;"></div>


  </div>
</section>

    <!-- TAB RECEITAS -->
    <section id="tabReceitas" class="tab-panel">
      <div class="card">
        <div class="card-header">
          <h2>Receitas</h2>
          <button class="btn primary" id="btnNovaReceita">‚ûï Nova receita</button>
        </div>

        <div class="search-input">
          <label for="recipeSearch">Buscar receita</label>
          <input type="text" id="recipeSearch" placeholder="Digite parte do nome, ingrediente, preparo ou link" />
        </div>

        <div class="filter-row">
          <select id="filterFav">
            <option value="">Todas</option>
            <option value="salgado">Salgados</option>
            <option value="doce">Doces</option>
            <option value="fav">Favoritas</option>
          </select>
        </div>

        <div id="recipesList" class="recipes-list"></div>
      </div>

      <div class="card" id="recipeFormCard" style="display:none;">
        <div class="card-header">
          <h2 id="recipeFormTitle">Nova receita</h2>
        </div>
        <form id="recipeForm">
          <label for="recipeName">Nome da receita</label>
          <input type="text" id="recipeName" required />

          <div class="field-row">
  <div>
    <label for="recipeKind">Tipo de receita</label>
    <select id="recipeKind" required>
      <option value="salgado">Salgado</option>
      <option value="doce">Doce</option>
    </select>
  </div>
  <div>
        <label for="recipeWork">Tipo de refei√ß√£o</label>
    <select id="recipeWork" required>
      <option value="principal">üçΩ Refei√ß√£o principal</option>
      <option value="cafe">‚òï Caf√©</option>
      <option value="sobremesa">üç∞ Sobremesa</option>
      <option value="lanche">‚òÄÔ∏è Lanche</option>
      <option value="ceia">üåí Ceia</option>
      <option value="petisco">üç∑ Petisco</option>
    
      <option value="saladas">ü•ó Saladas</option>
      <option value="molhos">ü•£ Molhos</option>
      <option value="temperos">üßÇ Temperos</option>
</select>

  </div>
</div>

<div class="field-row">
  <div>
    <label for="recipeProtein">Prote√≠na principal</label>
    <select id="recipeProtein" required>
      <option value="frango">üçó Frango</option>
      <option value="boi">ü•© Boi</option>
      <option value="porco">üêñ Porco</option>
      <option value="peixe">üêü Peixe</option>
      <option value="ovo">ü•ö Ovo</option>
      <option value="latic√≠neos">üßÄ Latic√≠neos</option>

      <option value="veg" selected>ü•¶ Veg</option>
    </select>
  </div>
  <div>
    <label for="recipeServings">Por√ß√µes (pessoas)</label>
    <input type="number" id="recipeServings" min="1" max="100" value="3" />
  </div>
</div>


          <label for="recipeIngredients">Ingredientes (opcional)<br>
            <span class="small">Um por linha (ex.: "500 g de frango", "2 tomates"...)</span>
          </label>
          <textarea id="recipeIngredients"></textarea>

          <label for="recipeInstructions">Modo de preparo (opcional)</label>
          <textarea id="recipeInstructions"></textarea>

          <label for="recipeLink">Link da receita (opcional)</label>
          <input type="url" id="recipeLink" placeholder="youtube.com/..." />

          <label for="recipePhoto">Foto (opcional)</label>
          <input type="file" id="recipePhoto" accept="image/*" />

          <div style="margin-top:0.75rem; text-align:right;">
            <button type="button" class="btn" id="btnCancelarReceita">Cancelar</button>
            <button type="submit" class="btn primary">Salvar receita</button>
          </div>
        </form>
      </div>
    </section>

    <!-- TAB DIA -->
    <section id="tabSemana" class="tab-panel">
      <div class="card">
        <div class="card-header">
          <h2>Op√ß√µes do dia</h2>
</div>

<p class="small" id="diaIntroText">
          Monte o card√°pio dos dias (1 a 14) escolhendo o tipo de refei√ß√£o e adicionando as receitas.
        </p>

        <div style="margin-bottom:0.5rem;">
          <button class="btn sm" id="btnVerCalendario">üìÜ Ver em calend√°rio semanal</button>
        </div>

        <p class="small">
          Op√ß√µes do dia: monte o card√°pio dos 14 dias.
        </p>

              <div class="toolbar">
  <div style="min-width:140px;">
    <label for="weekSelect" class="small">Dia</label>
<select id="weekSelect">
  <option value="0">Dia 1</option>
  <option value="1">Dia 2</option>
  <option value="2">Dia 3</option>
  <option value="3">Dia 4</option>
  <option value="4">Dia 5</option>
  <option value="5">Dia 6</option>
  <option value="6">Dia 7</option>
  <option value="7">Dia 8</option>
  <option value="8">Dia 9</option>
  <option value="9">Dia 10</option>
  <option value="10">Dia 11</option>
  <option value="11">Dia 12</option>
  <option value="12">Dia 13</option>
  <option value="13">Dia 14</option>
</select>

  </div>

  <div style="min-width:80px;">
    <label class="small">Dia da semana</label>
    <div id="weekdayLabel" class="small" style="font-weight:600; margin-top:0.45rem;">
      <!-- preenchido via JS, ex.: QUI -->
    </div>
  </div>

  <div style="min-width:180px;">
    <label for="mealSelect" class="small">Tipo de refei√ß√£o em edi√ß√£o</label>
    <select id="mealSelect">
      <option value="almoco">üçõ Almo√ßo</option>
      <option value="jantar">üçΩ Jantar</option>
      <option value="lanche">‚òï Lanches</option>
      <option value="petisco">üç∑ Petiscos</option>
    </select>
  </div>

  
  <!-- NOVO: bot√£o para abrir a Rotina j√° no mesmo dia -->
  <div style="min-width:160px;">
    <label class="small">&nbsp;</label>
    <button
      class="btn sm"
      id="btnOpenRotinaForDay"
      style="margin-top:0.45rem; width:100%;"
      type="button"
    >
      Abrir rotina do dia
    </button>
  </div>
</div>



        <div class="week-block">
          <div class="section-title" id="currentMealTitle">Op√ß√µes do dia</div>
          <div id="dayMealsContainer"></div>
          <div style="margin-top:0.5rem; display:flex; flex-wrap:wrap; gap:0.5rem;">
            <button class="btn sm" id="btnEditCurrentMeal">Adicionar receitas ao tipo selecionado</button>
            <button class="btn sm danger" id="btnClearDay">Limpar tudo do dia</button>
          </div>
        </div>
      </div>
    </section>
    
        <!-- TAB RESUMO -->
    <section id="tabResumo" class="tab-panel">
      <div class="card">
        <div class="card-header">
          <h2>üìä Resumo das refei√ß√µes</h2>
</div>
        <div id="statsResumoContent" class="stats-resumo">
          <!-- preenchido via JavaScript -->
        </div>
      </div>
    </section>


    <!-- TAB LISTA DE COMPRAS -->
    <section id="tabCompras" class="tab-panel">
      <div class="card">
        <div class="card-header">
          <h2>Lista de compras</h2>
</div>

        <div class="toolbar">
          <button class="btn primary" id="btnGerarLista">Gerar lista geral</button>
          <button class="btn danger sm" id="btnClearShopping">Limpar tudo</button>
        </div>

        <p class="small">
          A lista √© separada por receita.
        </p>

        <div id="shoppingListContainer"></div>
      </div>
    </section>
  </div>

  <!-- MODAL GEN√âRICO -->
  <div id="modalOverlay" class="modal-overlay">
    <div class="modal">
      <h2 id="modalTitle">Escolher receitas</h2>
      <div class="modal-content" id="modalContent"></div>
      <div class="modal-actions">
        <button class="btn" id="modalCancel">Cancelar</button>
        <button class="btn primary" id="modalSave">Salvar</button>
      </div>
    </div>
  </div>

  <!-- MODAL FOTO -->
  <div id="photoOverlay" class="modal-overlay">
    <div class="modal">
      <img id="photoOverlayImg" src="" alt="Foto da receita" />
    </div>
  </div>

  <!-- MODAL: CALEND√ÅRIO DO CARD√ÅPIO -->
  <div id="calendarOverlay" class="modal-overlay">
    <div class="modal">
      <h2>Calend√°rio do card√°pio</h2>
      <div class="modal-content" id="calendarContent"></div>
      <div class="modal-actions">
        <button class="btn" id="calendarClose">Fechar</button>
      </div>
    </div>
  </div>

 


<script>
(function() {
  const STORAGE_KEY = "cardapioMaeState_v7";
  const FONT_KEY = "cardapioMaeFontSize";

    


  const WEEKDAYS_SHORT = ["Seg", "Ter", "Qua", "Qui", "Sex", "S√°b", "Dom"];

  const INITIAL_RECIPES = [
     {
    "id": "recipe-1",
    "name": "Escondidinho de carne picada de peru",
    "receita": "salgado",
    "refeicao": "refei√ß√£o principal",
    "proteina": "frango",
    "ingredients": [
      "1 kg de batatas descascadas e cortadas em peda√ßos",
      "2 colheres de sopa de manteiga",
      "100 ml de leite (ou quanto baste)",
      "Sal e noz-moscada a gosto",
      "500 g de carne picada de peru",
      "1 cebola m√©dia, picada",
      "2 dentes de alho, picados",
      "1 tomate maduro picado (ou 100 g de polpa de tomate)",
      "1/2 pimento vermelho, picado (opcional)",
      "2 colheres de sopa de azeite",
      "1 colher de ch√° de colorau ou p√°prica doce",
      "Sal e pimenta-do-reino a gosto",
      "Salsa ou coentros frescos, picados (para finalizar)",
      "150 g de queijo mozarela ralado (ou queijo da sua prefer√™ncia)"
    ],
    "instructions": "1) Cozinhe as batatas em √°gua com uma pitada de sal at√© ficarem macias (cerca de 15‚Äì20 minutos). Escorra a √°gua e amasse as batatas com um espremedor ou garfo. Adicione a manteiga e o leite aos poucos, mexendo at√© obter um pur√™ cremoso. Tempere com sal e noz-moscada a gosto. Reserve.\n\n2) Numa frigideira grande, aque√ßa o azeite e refogue a cebola e o alho at√© ficarem macios. Junte a carne picada de peru e cozinhe at√© dourar. Adicione o tomate, o pimento (se for usar), o colorau, sal e pimenta. Cozinhe por mais cerca de 10 minutos, mexendo ocasionalmente, at√© o molho apurar. Finalize com salsa ou coentros picados.\n\n3) Pr√©-aque√ßa o forno a 200 ¬∞C. Numa travessa grande, espalhe uma camada uniforme de pur√™ de batata no fundo. Adicione o recheio de carne por cima e cubra com o restante pur√™, alisando a superf√≠cie com uma esp√°tula.\n\n4) Polvilhe o queijo ralado sobre o pur√™.\n\n5) Leve ao forno por cerca de 20 minutos, ou at√© o queijo derreter e dourar levemente.\n\n6) Retire do forno, deixe descansar por 5 minutos e sirva quente.",
    "favorite": false,
    "photo": null,
    "link": "https://cookpad.com/pt/receitas/24346747"
  },
  {
    "id": "r2",
    "name": "P√ÉO DE CEBOLA FOFINHO E SUPER F√ÅCIL DE FAZER",
    "receita": "",
    "refeicao": "salgadolanche",
    "proteina": "veg",
    "ingredients": [
      "gr√£o de bico cru com pele",
      "1 folha de louro",
      "1 dente de alho",
      "sal ",
      "2 unidades ovos",
      "1 unidade grande cebola picada",
      "meia x√≠cara de ch√° √≥leo",
      "2 colheres de ch√° sal",
      "6 x√≠caras de ch√° farinha de trigo",
      "1 x√≠cara de ch√° leite morno",
      "2 tabletes fermento biol√≥gico",
      "1 unidade gema de ovo",
      "meia x√≠cara de ch√° caf√© coado",
      "or√©gano a gosto "
    ],
    "instructions": "",
    "favorite": false,
    "photo": null,
    "link": "https://youtu.be/QLuoU5eTu58?si=Ilk4S1vM_g7zCIe6"
  },
  {
    "id": "r3",
    "name": "CUCA DE BANANA COM FAROFA FITNESS",
    "receita": "doce",
    "refeicao": "lanche",
    "proteina": "veg",
    "ingredients": [
      "# Farofa para Cobertura",
      "50 gramas de Farinha de aveia",
      "1/4 de x√≠cara de Ado√ßante (usei Xilitol)",
      "1 colher (ch√°) de Canela",
      "2 colheres (sopa) de √ìleo de coco",
      "# Bolo",
      "1 Ovo",
      "1/2 de x√≠cara de Ado√ßante (usei Xilitol)",
      "1 colher (sopa) de √ìleo de coco",
      "100 gramas de Farinha de aveia",
      "60 ml de Leite de coco",
      "1 colher (ch√°) de Fermento ",
      "2 bananas cortadas em tiras",
      "# Forma untada e enfarinhada com √≥leo de coco e farinha de aveia"
    ],
    "instructions": "",
    "favorite": false,
    "photo": null,
    "link": "https://youtu.be/DlC4JaxkKjI?si=C0--QIRTlg0UvgC1"
  },
  {
    "id": "r4",
    "name": "BOLO DE FUB√Å SIMPLES E R√ÅPIDO COM BANANA SEM GL√öTEN SEM LACTOSE",
    "receita": "lanche",
    "refeicao": "doce",
    "proteina": "veg",
    "ingredients": [],
    "instructions": "",
    "favorite": false,
    "photo": null,
    "link": "https://youtu.be/gKsy_BjD0Vc?si=56Bi2m0BMun44990"
  },
  {
    "id": "r5",
    "name": "BOLO DE FUB√Å CREMOSO DE LIQUIDIFICADOR",
    "receita": "lanche",
    "refeicao": "doce",
    "proteina": "veg",
    "ingredients": [
      "4 ovos",
      "2 colheres de sopa de margarina ou manteiga",
      "4 x√≠caras de leite ( 240 ml cada / quase 1 litro )",
      "3 x√≠caras de a√ß√∫car",
      "1 x√≠cara e 1/2 de fub√°",
      "2 colheres de sopa de trigo",
      "1 colher de sopa de fermento qu√≠mico para bolos",
      "1 pacotinho de queijo ralado ( 100 gr )"
    ],
    "instructions": " As x√≠caras do v√≠deo s√£o de 240 ml cada.\n  # Medidas da forma do v√≠deo:\n-36 cm de comprimento\n-26 cm de largura\n-05 cm de profundidade",
    "favorite": false,
    "photo": null,
    "link": "https://youtu.be/vpT_id4h9Lg?si=f3WvNSk7UBJorqW1"
  },
  {
    "id": "r6",
    "name": "Bolo de caf√© com chocolate",
    "receita": "lanche",
    "refeicao": "doce",
    "proteina": "veg",
    "ingredients": [
      "Bolo de chocolate (sem farinha)",
      "Chocolate Amargo 100g",
      "Manteiga 85g",
      "Cacau em p√≥ 6g",
      "A√ß√∫car 100g",
      "6 ovos",
      "Sal 1g"
    ],
    "instructions": "Asse em forno a 180 ¬∞ C por 10 a 12 min\n\nCreme de Chantilly de caf√© com chocolate\nChocolate Amargo 130g\nLeite 75g\nGr√£o de caf√© 10g\nChantilly 300g\nA√ß√∫car 25g\n\nRaspas de chocolate decorativas",
    "favorite": false,
    "photo": null,
    "link": "https://youtu.be/XFB1RGqrq1o?si=bv3XJnUrVykby3wy"
  },
  {
    "id": "r7",
    "name": "Biscoito de coco vegano e sem gl√∫ten",
    "receita": "lanche",
    "refeicao": "doce",
    "proteina": "veg",
    "ingredients": [
      "1/2 x√≠cara (ch√°) de farinha de am√™ndoas",
      "1/2 x√≠cara (ch√°) de coco ralado (sem a√ß√∫car)",
      "1/2 x√≠cara (ch√°) de a√ß√∫car demerara",
      "1 x√≠cara (ch√°) de farinha de arroz",
      "At√© dar o ponto- √°gua de coco (um pouco menos que 1/2 x√≠cara)."
    ],
    "instructions": "Misture bem os primeiros 4 ingredientes.\nV√° adicionando aos poucos a √°gua de coco, enquanto mistura a massa com as m√£os (amassando).\nAdicione at√© a massa estar perfeita para ser modelada, sem grudar nas m√£os.\nAbra a massa com cuidado, com rolo ou manualmente (caso opte pelo rolo pode polvilhar mais um pouquinho de farinha de arroz) e corte os biscoitos com aux√≠lio de um molde.\nDisponha os biscoitos em uma assadeira untada com √≥leo de coco e leve ao forno pr√©-aquecido a 180¬∞C por 25/30 minutos (v√° observando para n√£o queimar as bordas).\nEspere esfriar e aproveite!",
    "favorite": false,
    "photo": null,
    "link": "https://catracalivre.com.br/gastronomia/biscoito-de-coco-vegano-para-comer-com-aquele-cafezinho/"
  },
  {
    "id": "r8",
    "name": "Broa de fub√° sem trigo sem leite, derrete na boca fica uma del√≠cia",
    "receita": "lanche",
    "refeicao": "doce",
    "proteina": "veg",
    "ingredients": [
      "1 x√≠cara de fub√° ",
      "1 x√≠cara de amido de milho ",
      "1 ovo",
      "2 colheres de sopa de manteiga derretida",
      "1/2 x√≠cara de a√ß√∫car demerara ",
      "1 colher de ch√° de fermento em p√≥ "
    ],
    "instructions": "Umas 3 colheres de sopa de leite de coco.\n( medida da x√≠cara usada √© de 200ML)\n(Tempo de forno 20 minutos a 180graus)",
    "favorite": false,
    "photo": null,
    "link": "https://youtu.be/30VuwX-67Nk?si=JXAVDeeDTGuVeIYj"
  },
  {
    "id": "r9",
    "name": "Bolo de ma√ß√£ delicioso (e sem gl√∫ten) ",
    "receita": "lanche",
    "refeicao": "doce",
    "proteina": "veg",
    "ingredients": [
      "Tr√™s ma√ß√£s",
      "150 gramas de pasta de t√¢maras",
      "200 mililitros de √°gua",
      "Uma colher de sopa de canela",
      "Uma ch√°vena e meia de aveia",
      "Meia ch√°vena de fub√° de mandioca",
      "Tr√™s quartos de ch√°vena de √≥leo de coco",
      "Quatro ovos",
      "Uma colher de ch√° de extrato de baunilha",
      "Uma laranja para sumo."
    ],
    "instructions": "Num tacho, coloque a pasta de t√¢mara, a √°gua e a canela. Deixe cozer para amolecer um pouco a pasta e triture tudo. Retire do lume e reserve. Num processador, ou robot de cozinha, coloque os restantes ingredientes, exceto as ma√ß√£s, e triture muito bem.\n\nCorte as ma√ß√£s em fatias, coloque-as dentro do preparado de t√¢maras e envolva-as bem. Numa forma untada com √≥leo de coco, verta metade da massa e coloque algumas das tiras de ma√ßa, adicione o resto da massa e, por fim, as √∫ltimas fatias de ma√ßa. Leve ao forno, pr√©-aquecido a 180 graus, durante cerca de uma hora.",
    "favorite": false,
    "photo": null,
    "link": "https://www.nit.pt/fit/este-bolo-de-maca-delicioso-e-sem-gluten-prepara-se-em-10-minutos"
  },
  {
    "id": "r10",
    "name": "Bolo cremoso de fub√°",
    "receita": "lanche",
    "refeicao": "doce",
    "proteina": "veg",
    "ingredients": [],
    "instructions": "",
    "favorite": false,
    "photo": null,
    "link": "https://youtu.be/FdEBfu9P8MU?si=6q4k1Eh9hqMy8BuQ"
  },
  {
    "id": "r11",
    "name": "Bolo Cremoso de Aipim",
    "receita": "lanche",
    "refeicao": "doce",
    "proteina": "veg",
    "ingredients": [
      "1 kg de aipim (cru ralado)",
      "3 ovos",
      "200 ml de leite de coco",
      "100 g de coco ralado em flocos",
      "2 colheres (sopa) de a√ß√∫car",
      "1 copo de requeij√£o cremoso"
    ],
    "instructions": "Passo 1\nNo liquidificador, bata o aipim picado com os ovos, a margarina, o leite de coco e o leite;\nPasso 2\nColoque em uma tigela e misture o coco e o a√ß√∫car;\nPasso 3\nAsse em uma assadeira untada, at√© dourar.",
    "favorite": false,
    "photo": null,
    "link": "https://comidinhasdochef.com/bolo-cremoso-de-aipim/"
  },
  {
    "id": "r12",
    "name": "Bolo de Fub√° uma receita de v√≥",
    "receita": "lanche",
    "refeicao": "doce",
    "proteina": "veg",
    "ingredients": [
      "2 ovos",
      "2 x√≠caras (ch√°) de fub√°",
      "1 colher (sopa) de fermento em p√≥",
      "1 x√≠cara (ch√°) de farinha de trigo",
      "12 colheres (sopa) de margarina",
      "1/2 x√≠cara (ch√°) de √≥leo",
      "2 x√≠caras (ch√°) de a√ß√∫car",
      "1 x√≠cara (ch√°) de leite",
      "1 colher (sopa) de sementes de erva-doce",
      "# Margarina e farinha de trigo para untar"
    ],
    "instructions": "Em uma tigela, misture todos os ingredientes, menos a erva-doce, at√© obter uma massa homog√™nea. Ent√£o, acrescente a erva-doce e mexa at√© incorporar.\n\nEm seguida, coloque em uma f√¥rma de buraco no meio de 24cm de di√¢metro untada e enfarinhada.\n\nEnt√£o, leve ao forno m√©dio, preaquecido, por 25 minutos ou at√© que ao enfiar um palito, ele saia limpo.",
    "favorite": false,
    "photo": null,
    "link": "https://receitasdepesos.com.br/receitas/2020/07/10/bolo-de-fuba-uma-receita-de-vo-vem-ver/"
  },
  {
    "id": "r13",
    "name": "Bolo de banana com aveia e sem farinha trigo",
    "receita": "lanche",
    "refeicao": "doce",
    "proteina": "veg",
    "ingredients": [
      "4 bananas nanicas bem maduras (400g)",
      "2 ovos",
      "3 colheres (sopa) de manteiga derretida (36g)",
      "1/4 de x√≠cara de a√ß√∫car (50g)",
      "1 x√≠cara de aveia em flocos finos (135g)",
      "1 colher (sopa) fermento qu√≠mico (15g)",
      "1/2 de colher (ch√°) de canela em p√≥ (pode usar baunilha se preferir)"
    ],
    "instructions": "1.Em um recipiente, amasse as bananas com um garfo at√© formar um creme;\n\n2.Junte agora os ovos e a manteiga derretida e bata muito bem at√© se formar um creme homog√™neo;\n\n3.Agora junte o a√ß√∫car e misture at√© que ele se dissolva;\n\n4.Por fim adicione a aveia e o fermento e misture bem at√© que tudo se incorpore;\n\n5.Transfira a mistura para uma forma untada e enfarinhada (a que usei tem 18cm de di√¢metro com furo central);\n\n6.Por cima adicione algumas bananas cortadas em rodelas e polvilhe tudo com um pouco de a√ß√∫car e canela (essa parte √© opcional);\n\n7.Leve para assar em forno pr√©-aquecido √† 180¬∞C durante cerca de 30 minutos ou at√© que espetando seu bolo com um palito ele saia limpo;\n\n8.Se o palito sair levemente √∫mido, n√£o se assuste, como esta massa leva bastante fruta, isso √© normal;\n\n9.Depois disso √© esperar esfriar para desenformar e servir;",
    "favorite": false,
    "photo": null,
    "link": "https://catracalivre.com.br/gastronomia/bolo-de-banana-com-aveia-e-sem-farinha-trigo/"
  },
  {
    "id": "r14",
    "name": "Bolo Monache (bolo de freiras)",
    "receita": "lanche",
    "refeicao": "doce",
    "proteina": "veg",
    "ingredients": [
      "250 g de ricota",
      "3 ovos",
      "125 g de a√ß√∫car",
      "130 g de farinha de am√™ndoa",
      "1 colher de ch√° de raspas de lim√£o",
      "1 colher de ch√° de extrato de baunilha",
      "2 colheres de sopa de licor (amaretto, rum ou licor de laranja)",
      "1 pitada de sal",
      "A√ß√∫car de confeiteiro a gosto"
    ],
    "instructions": "1. Peneire a ricota e deixe escorrer 12h na geladeira para remover o excesso de umidade;\n\n2. Bata os ovos e o a√ß√∫car em uma tigela at√© obter uma mistura espumosa e transparente. Adicione a ricota peneirada com movimentos de dobra para manter a aera√ß√£o;\n\n3. Adicione a farinha de am√™ndoa, as raspas de lim√£o e a pitada de sal misturando delicadamente. Em seguida, adicione o extrato de baunilha e o licor de sua prefer√™ncia, misturando com uma esp√°tula at√© que todos os ingredientes estejam bem homog√™neos;\n\n4. Unte uma forma redonda com manteiga e polvilhe com farinha de am√™ndoas para evitar que o bolo grude. Despeje a mistura na forma, nivele a superf√≠cie e leve ao forno preaquecido a 170 ¬∞C por 35-40 minutos.\n\n5. Quando a superf√≠cie estiver dourada, teste com um palito. Se o palito sair limpo, o bolo est√° pronto. Retire o bolo do forno e deixe esfriar completamente antes de polvilhar com a√ß√∫car de confeiteiro.",
    "favorite": false,
    "photo": null,
    "link": "https://www.tudogostoso.com.br/noticias/nem-farinha-nem-fermento-um-bolo-muito-fofo-feito-pelas-avos-italianas-e-sua-receita-centenaria-saiba-como-fazer-o-bolo-das-freiras-a19225.htm"
  },
  {
    "id": "r15",
    "name": "Bolo Chocolate de Liquidificador",
    "receita": "lanche",
    "refeicao": "doce",
    "proteina": "veg",
    "ingredients": [
      " Bolo",
      "1 colher de sopa de ess√™ncia de baunilha",
      "1 x√≠cara de ch√° de chocolate em p√≥ 50% cacau",
      "2 x√≠caras de ch√° de farinha de trigo tradicional sem fermento",
      "1 colher de sopa de fermento qu√≠mico em p√≥",
      "3 ovos",
      "2 x√≠caras de ch√° de a√ß√∫car cristal",
      "4 colheres de sopa de manteiga/margarina derretida",
      "1 x√≠cara de ch√° de leite integral levemente morno",
      "# Calda de Doce de Leite",
      "200 gramas de doce de leite a sua preferencia (estou utilizando lata de leite condensado cozida na panela de press√£o)",
      "1 caixa de creme de leite (caixa com 200 gramas)",
      "# Cobertura de Alpino",
      "400 gramas de doce de leite da sua prefer√™ncia",
      "100 gramas de creme de leite",
      "1/2 colher de sopa de ess√™ncia de baunilha",
      "1 colher de sopa de chocolate em p√≥ 50% cacau",
      "200 gramas de chocolate nobre meio amargo derretido"
    ],
    "instructions": "PREPARO DO BOLO\n  Coloque todos os ingredientes em um liquidificador, exceto a farinha de trigo e o fermento, e liquidifique at√© homogeneizar.\n\nEnt√£o, despeje a mistura em um tigela e acrescente a farinha de trigo aos poucos sempre peneirando e misturando bem.\n\nEm seguida, finalize com o fermento apenas incorporando levemente at√© homogeneizar.\n\nPor fim, despeje em uma forna quadrada untada e polvilhada farinha de trigo/chocolate, em seguida leve em forno pr√© aquecido a 180¬∫C por aproximadamente 50 minutos ou at√© fazer o teste espetando um palito no centro do bolo, se o mesmo sair limpo e seco quer dizer que est√° pronto.\n\nPREPARO DA CALDA\nColoque os ingredientes em um bowl (tigela) e misture at√© homogenizar.\n\nPREPARO DA COBERTURA\nEm seguida, coloque todos os ingredientes em uma batedeira ou tigela se n√£o tiver batedeira, exceto o chocolate derretido e bata por aproximadamente 3 minutinhos at√© homogenizar e ficar bem cremosinho.\nEnt√£o, adicione o chocolate derretido e bata por mais 2 minutinhos at√© homogenizar.\n\nMONTAGEM\n\nPor fim, com um garfo ou espeto de churrasco, fa√ßa diversos furos por toda a massa do bolo ainda na f√¥rma.\n\nEm seguida, despeje a calda de doce de leite por cima e deixe penetrar a massa, em seguida despeje toda a cobertura de alpino e espalhe bem fazendo uma camada bem uniforme.\n\nLeve para geladeira por 3 horas e decore com granulados a gosto e √© s√≥ servir seu bolo de chocolate molhadinho.",
    "favorite": false,
    "photo": null,
    "link": "https://receitasdepesos.com.br/receitas/2020/12/19/esse-bolo-chocolate-de-liquidificador-molhadinho-e-muito-facil-de-fazer/"
  },
  {
    "id": "homus-cenoura-ou-pepino",
    "name": "Homus + cenoura ou pepino",
    "receita": "salgado",
    "refeicao": "",
    "proteina": "leguminosa",
    "ingredients": [
      "homus",
      "cenoura",
      "pepino"
    ],
    "instructions": "Sirva o homus com palitos de cenoura e/ou pepino.",
    "favorite": false,
    "photo": null,
    "link": ""
  },
  {
    "id": "ovo-de-codorna",
    "name": "Ovo de codorna",
    "receita": "salgado",
    "refeicao": "",
    "proteina": "ovo",
    "ingredients": [
      "ovos de codorna",
      "sal (opcional)"
    ],
    "instructions": "Cozinhe os ovos de codorna e sirva com uma pitadinha de sal, se desejar.",
    "favorite": false,
    "photo": null,
    "link": null
  },
  {
    "id": "castanhas-nozes-amendoas",
    "name": "Castanhas (nozes/am√™ndoas)",
    "receita": "salgado",
    "refeicao": "",
    "proteina": "vegetal",
    "ingredients": [
      "nozes",
      "am√™ndoas"
    ],
    "instructions": "Consuma uma por√ß√£o pequena de castanhas como caf√© da manh√£ ou lanche.",
    "favorite": false,
    "photo": null,
    "link": ""
  },
  {
    "id": "morango-com-chia-ou-castanhas",
    "name": "Morango com chia ou castanhas",
    "receita": "doce",
    "refeicao": "",
    "proteina": "vegetal",
    "ingredients": [
      "morango",
      "chia",
      "castanhas"
    ],
    "instructions": "Sirva morangos com chia e/ou uma por√ß√£o pequena de castanhas.",
    "favorite": false,
    "photo": null,
    "link": ""
  },
  {
    "id": "pera-com-chia-ou-castanhas",
    "name": "Pera com chia ou castanhas",
    "receita": "doce",
    "refeicao": "",
    "proteina": "vegetal",
    "ingredients": [
      "pera",
      "chia",
      "castanhas"
    ],
    "instructions": "Sirva pera fatiada com chia e/ou uma por√ß√£o pequena de castanhas.",
    "favorite": false,
    "photo": null,
    "link": ""
  },
  {
    "id": "maca-com-chia-ou-castanhas",
    "name": "Ma√ß√£ com chia ou castanhas",
    "receita": "doce",
    "refeicao": "",
    "proteina": "vegetal",
    "ingredients": [
      "ma√ß√£",
      "chia",
      "castanhas"
    ],
    "instructions": "Sirva ma√ß√£ fatiada com chia e/ou uma por√ß√£o pequena de castanhas.",
    "favorite": false,
    "photo": null,
    "link": ""
  },
  {
    "id": "kiwi-com-chia-ou-castanhas",
    "name": "Kiwi com chia ou castanhas",
    "receita": "doce",
    "refeicao": "",
    "proteina": "vegetal",
    "ingredients": [
      "kiwi",
      "chia",
      "castanhas"
    ],
    "instructions": "Sirva kiwi com chia e/ou uma por√ß√£o pequena de castanhas.",
    "favorite": false,
    "photo": null,
    "link": ""
  },
  {
    "id": "creme-de-abacate-limao-sal",
    "name": "Creme de abacate (abacate + lim√£o + sal)",
    "receita": "salgado",
    "refeicao": "",
    "proteina": "vegetal",
    "ingredients": [
      "abacate",
      "lim√£o",
      "sal"
    ],
    "instructions": "Amasse o abacate e tempere com lim√£o e uma pitada de sal.",
    "favorite": false,
    "photo": null,
    "link": ""
  },
  {
    "id": "frango-grelhado-legumes-vapor-arroz-integral",
    "name": "Frango grelhado + legumes no vapor + arroz integral",
    "receita": "salgado",
    "refeicao": "",
    "proteina": "frango",
    "ingredients": [
      "peito de frango",
      "legumes variados",
      "arroz integral",
      "azeite",
      "sal",
      "temperos a gosto"
    ],
    "instructions": "Grelhe o frango, cozinhe os legumes no vapor e sirva com arroz integral. Finalize com um fio de azeite.",
    "favorite": false,
    "photo": null,
    "link": ""
  },
  {
    "id": "carne-moida-abobrinha-tomate-refogado",
    "name": "Carne mo√≠da + abobrinha + tomate (refogado)",
    "receita": "salgado",
    "refeicao": "",
    "proteina": "carne",
    "ingredients": [
      "carne mo√≠da",
      "abobrinha",
      "tomate",
      "cebola (opcional)",
      "alho (opcional)",
      "azeite",
      "sal",
      "temperos a gosto"
    ],
    "instructions": "Refogue a carne mo√≠da com azeite e temperos. Acrescente abobrinha e tomate e cozinhe at√© ficar macio.",
    "favorite": false,
    "photo": null,
    "link": null
  },
  {
    "id": "grao-de-bico-com-abobora",
    "name": "Gr√£o-de-bico com ab√≥bora",
    "receita": "salgado",
    "refeicao": "",
    "proteina": "leguminosa",
    "ingredients": [
      "gr√£o-de-bico",
      "ab√≥bora",
      "cebola (opcional)",
      "alho (opcional)",
      "azeite",
      "sal",
      "temperos a gosto"
    ],
    "instructions": "Cozinhe o gr√£o-de-bico. Refogue a ab√≥bora com temperos e misture ao gr√£o-de-bico at√© incorporar.",
    "favorite": false,
    "photo": null,
    "link": ""
  },
  {
    "id": "quinoa-cogumelos-legumes",
    "name": "Quinoa + cogumelos + legumes",
    "receita": "salgado",
    "refeicao": "",
    "proteina": "vegetal",
    "ingredients": [
      "quinoa",
      "cogumelos",
      "legumes variados",
      "azeite",
      "sal",
      "temperos a gosto"
    ],
    "instructions": "Cozinhe a quinoa. Salteie cogumelos e legumes no azeite e misture √† quinoa.",
    "favorite": false,
    "photo": null,
    "link": ""
  },
  {
    "id": "arroz-feijao-bife-grelhado-salada",
    "name": "Arroz + feij√£o + bife grelhado + salada",
    "receita": "salgado",
    "refeicao": "",
    "proteina": "carne",
    "ingredients": [
      "arroz",
      "feij√£o",
      "bife",
      "salada",
      "azeite",
      "sal",
      "temperos a gosto"
    ],
    "instructions": "Sirva arroz e feij√£o com bife grelhado e salada. Ajuste a por√ß√£o de arroz conforme necessidade.",
    "favorite": false,
    "photo": null,
    "link": ""
  },
  {
    "id": "pure-de-inhame-frango-desfiado",
    "name": "Pur√™ de inhame + frango desfiado",
    "receita": "salgado",
    "refeicao": "",
    "proteina": "frango",
    "ingredients": [
      "inhame",
      "frango desfiado",
      "sal",
      "temperos a gosto",
      "azeite (opcional)"
    ],
    "instructions": "Cozinhe e amasse o inhame at√© virar pur√™. Misture ou sirva com frango desfiado temperado.",
    "favorite": false,
    "photo": null,
    "link": ""
  },
  {
    "id": "bowl-seguro-base-proteina-legumes",
    "name": "Bowl seguro (base + prote√≠na + legumes)",
    "receita": "salgado",
    "refeicao": "",
    "proteina": "misto",
    "ingredients": [
      "arroz integral ou quinoa",
      "frango ou ovo ou atum",
      "cenoura",
      "pepino",
      "abobrinha",
      "azeite",
      "gergelim"
    ],
    "instructions": "Escolha uma base (arroz integral ou quinoa), adicione uma prote√≠na (frango, ovo ou atum), complete com legumes e finalize com azeite e gergelim.",
    "favorite": false,
    "photo": null,
    "link": ""
  },
  {
    "id": "sopa-de-legumes-com-curcuma",
    "name": "Sopa de legumes com c√∫rcuma",
    "receita": "salgado",
    "refeicao": "",
    "proteina": "vegetal",
    "ingredients": [
      "legumes variados",
      "c√∫rcuma",
      "azeite",
      "sal",
      "temperos a gosto"
    ],
    "instructions": "Cozinhe os legumes e tempere com c√∫rcuma. Finalize com azeite.",
    "favorite": false,
    "photo": null,
    "link": ""
  },
  {
    "id": "sopa-cremosa-inhame-frango",
    "name": "Sopa cremosa de inhame + frango",
    "receita": "salgado",
    "refeicao": "",
    "proteina": "frango",
    "ingredients": [
      "inhame",
      "frango desfiado",
      "sal",
      "temperos a gosto"
    ],
    "instructions": "Cozinhe o inhame e bata at√© ficar cremoso. Acrescente frango desfiado temperado e aque√ßa.",
    "favorite": false,
    "photo": null,
    "link": ""
  },
  {
    "id": "sopa-de-abobora-com-gengibre",
    "name": "Sopa de ab√≥bora + gengibre",
    "receita": "salgado",
    "refeicao": "",
    "proteina": "vegetal",
    "ingredients": [
      "ab√≥bora",
      "gengibre",
      "sal",
      "temperos a gosto",
      "azeite (opcional)"
    ],
    "instructions": "Cozinhe a ab√≥bora com gengibre e bata at√© formar um creme. Ajuste o sal e finalize com azeite, se quiser.",
    "favorite": false,
    "photo": null,
    "link": ""
  },
  {
    "id": "chia-hidratada",
    "name": "Chia hidratada",
    "receita": "doce",
    "refeicao": "",
    "proteina": "vegetal",
    "ingredients": [
      "chia",
      "√°gua ou bebida vegetal"
    ],
    "instructions": "Hidrate a chia em √°gua ou bebida vegetal at√© formar um gel.",
    "favorite": false,
    "photo": null,
    "link": ""
  },
  {
    "id": "tahine",
    "name": "Tahine",
    "receita": "salgado",
    "refeicao": "",
    "proteina": "vegetal",
    "ingredients": [
      "tahine"
    ],
    "instructions": "Use tahine como pastinha, molho ou complemento de bowls e lanches.",
    "favorite": false,
    "photo": null,
    "link": ""
  },
  {
    "id": "curcuma-com-pimenta-do-reino",
    "name": "C√∫rcuma + pimenta-do-reino",
    "receita": "tanto faz",
    "refeicao": "",
    "proteina": "vegetal",
    "ingredients": [
      "c√∫rcuma",
      "pimenta-do-reino"
    ],
    "instructions": "Adicione c√∫rcuma com uma pitada de pimenta-do-reino em preparos do dia a dia.",
    "favorite": false,
    "photo": null,
    "link": ""
  },
  {
    "id": "limao-com-azeite",
    "name": "Lim√£o + azeite",
    "receita": "salgado",
    "refeicao": "",
    "proteina": "vegetal",
    "ingredients": [
      "lim√£o",
      "azeite",
      "sal (opcional)"
    ],
    "instructions": "Tempere saladas e legumes com lim√£o e azeite para uma op√ß√£o leve e saborosa.",
    "favorite": false,
    "photo": null,
    "link": ""
  },
  {
    "id": "tapioca-ovo-curcuma-azeite",
    "name": "Tapioca + ovo + c√∫rcuma + azeite",
    "receita": "salgado",
    "refeicao": "",
    "proteina": "ovo",
    "ingredients": [
      "tapioca",
      "ovo",
      "c√∫rcuma",
      "azeite",
      "sal (opcional)"
    ],
    "instructions": "Fa√ßa uma tapioca pequena. Coloque 1 ovo mexido dentro. Tempere com c√∫rcuma e finalize com azeite.",
    "favorite": false,
    "photo": null,
    "link": ""
  },
  {
    "id": "pao-frigideira-polvilho-ovo-sem-lactose",
    "name": "P√£o de frigideira (polvilho + ovo) ‚Äî sem lactose",
    "receita": "salgado",
    "refeicao": "",
    "proteina": "ovo",
    "ingredients": [
      "polvilho",
      "ovo",
      "sal"
    ],
    "instructions": "Misture 2 colheres de polvilho com 1 ovo e sal. Leve √† frigideira e doure dos dois lados.",
    "favorite": false,
    "photo": null,
    "link": ""
  },
  {
    "id": "omelete-vegetal",
    "name": "Omelete vegetal",
    "receita": "salgado",
    "refeicao": "",
    "proteina": "ovo",
    "ingredients": [
      "ovo",
      "espinafre",
      "cebola",
      "c√∫rcuma",
      "azeite",
      "sal (opcional)"
    ],
    "instructions": "Refogue cebola e espinafre rapidamente no azeite. Junte ovos batidos com c√∫rcuma e cozinhe at√© firmar.",
    "favorite": false,
    "photo": null,
    "link": ""
  },
  {
    "id": "aveioca-sem-lactose",
    "name": "Aveioca sem lactose (aveia + ovo)",
    "receita": "salgado",
    "refeicao": "",
    "proteina": "ovo",
    "ingredients": [
      "aveia",
      "ovo",
      "sal (opcional)"
    ],
    "instructions": "Misture aveia com 1 ovo at√© formar uma massa. Doure na frigideira.",
    "favorite": false,
    "photo": null,
    "link": ""
  },
  {
    "id": "iogurte-zero-lactose-chia-morango",
    "name": "Iogurte zero lactose + chia + morango",
    "receita": "doce",
    "refeicao": "",
    "proteina": "laticinio",
    "ingredients": [
      "iogurte zero lactose",
      "chia",
      "morango"
    ],
    "instructions": "Misture chia no iogurte e finalize com morangos.",
    "favorite": false,
    "photo": null,
    "link": ""
  },
  {
    "id": "cafe-tapioca-queijo-tahine",
    "name": "ü´ì Tapioca + queijo + tahine (vers√£o base)",
    "receita": "salgado",
    "refeicao": "",
    "proteina": "queijo",
    "ingredients": [
      "goma de tapioca",
      "queijo (minas / mu√ßarela / minas padr√£o)",
      "tahine",
      "or√©gano ou p√°prica"
    ],
    "instructions": "‚ö†Ô∏è RI: manter por√ß√£o pequena. Receita: preparar a tapioca na frigideira, rechear com 1 fatia de queijo, 1 colher de ch√° de tahine e finalizar com or√©gano ou p√°prica. R√°pida, est√°vel e pouco inflamat√≥ria.",
    "favorite": false,
    "photo": null,
    "link": null
  },
  {
    "id": "cafe-tapioca-ovo-curcuma",
    "name": "ü´ì Tapioca + ovo + c√∫rcuma",
    "receita": "salgado",
    "refeicao": "",
    "proteina": "ovo",
    "ingredients": [
      "goma de tapioca",
      "ovo",
      "c√∫rcuma",
      "sal",
      "chia (opcional, para RI)"
    ],
    "instructions": "‚ö†Ô∏è RI: manter por√ß√£o pequena (cerca de 2 colheres de sopa de goma). Hidrate a tapioca na frigideira, acrescente 1 ovo batido com c√∫rcuma e sal, deixe firmar e dobre. Dica RI: 1 colher de chia dentro ajuda a reduzir pico glic√™mico.",
    "favorite": false,
    "photo": null,
    "link": null
  },
  {
    "id": "cafe-pao-frigideira-polvilho",
    "name": "ü´ì P√£o de frigideira de polvilho",
    "receita": "salgado",
    "refeicao": "",
    "proteina": "ovo",
    "ingredients": [
      "ovo",
      "polvilho doce ou azedo",
      "queijo ralado ou em cubinhos (opcional)",
      "sal e temperos a gosto"
    ],
    "instructions": "Misture ovo, polvilho e queijo at√© formar massa grossinha. Coloque na frigideira antiaderente e doure dos dois lados. Funciona como p√£o r√°pido sem gl√∫ten.",
    "favorite": false,
    "photo": null,
    "link": null
  },
  {
    "id": "cafe-tapioca-proteica",
    "name": "ü´ì Tapioca proteica",
    "receita": "salgado",
    "refeicao": "",
    "proteina": "ovo",
    "ingredients": [
      "goma de tapioca",
      "ovo",
      "queijo",
      "tahine"
    ],
    "instructions": "‚ö†Ô∏è RI: manter por√ß√£o pequena. Preparar a tapioca e rechear com ovo mexido r√°pido, queijo e um pouquinho de tahine. Fica muito saciante e ajuda a evitar picos glic√™micos.",
    "favorite": false,
    "photo": null,
    "link": null
  },
  {
    "id": "cafe-tapioca-bruschetta",
    "name": "ü´ì Tapioca salgada tipo ‚Äúbruschetta‚Äù",
    "receita": "salgado",
    "refeicao": "",
    "proteina": "queijo",
    "ingredients": [
      "goma de tapioca",
      "queijo",
      "tahine",
      "tomate picado",
      "or√©gano",
      "fio de azeite (opcional)"
    ],
    "instructions": "‚ö†Ô∏è RI: manter por√ß√£o pequena. Preparar a tapioca, passar tahine, colocar queijo e tomate picado, finalizar com or√©gano e, se quiser, um fio de azeite. Fica com cara de bruschetta.",
    "favorite": false,
    "photo": null,
    "link": null
  },
  {
    "id": "cafe-tapioca-frango-tahine",
    "name": "ü´ì Tapioca com tahine + frango desfiado",
    "receita": "salgado",
    "refeicao": "",
    "proteina": "frango",
    "ingredients": [
      "goma de tapioca",
      "frango desfiado pronto",
      "tahine",
      "queijo (opcional)"
    ],
    "instructions": "‚ö†Ô∏è RI: manter por√ß√£o pequena. Rechear a tapioca com frango desfiado, 1 colher de tahine e, se quiser, queijo. Vira uma refei√ß√£o completa e r√°pida.",
    "favorite": false,
    "photo": null,
    "link": null
  },
  {
    "id": "cafe-tapioca-homus",
    "name": "ü´ì Tapioca + homus",
    "receita": "salgado",
    "refeicao": "",
    "proteina": "veg",
    "ingredients": [
      "goma de tapioca fininha",
      "homus de gr√£o-de-bico",
      "lim√£o"
    ],
    "instructions": "‚ö†Ô∏è RI: manter por√ß√£o pequena. Preparar uma tapioca bem fina e rechear com 2 colheres de homus e um pouco de lim√£o. Op√ß√£o vegana e rica em fibra.",
    "favorite": false,
    "photo": null,
    "link": null
  },
  {
    "id": "cafe-pao-graodebico",
    "name": "üçû P√£o de frigideira (farinha de gr√£o-de-bico)",
    "receita": "salgado",
    "refeicao": "",
    "proteina": "veg",
    "ingredients": [
      "farinha de gr√£o-de-bico",
      "ovo",
      "√°gua",
      "sal",
      "temperos (c√∫rcuma, p√°prica, or√©gano)"
    ],
    "instructions": "Misture 2 colheres de farinha de gr√£o-de-bico com 1 ovo, √°gua at√© ponto de massa grossa, sal e temperos. Coloque na frigideira antiaderente e doure. Excelente para RI: muita prote√≠na e fibra.",
    "favorite": false,
    "photo": null,
    "link": null
  },
  {
    "id": "cafe-paozinho-milharina",
    "name": "üåΩ P√£ozinho de Milharina",
    "receita": "salgado",
    "refeicao": "",
    "proteina": "ovo",
    "ingredients": [
      "ovo",
      "milharina ou floc√£o",
      "√°gua para hidratar",
      "chia ou linha√ßa",
      "sal",
      "temperos (c√∫rcuma, p√°prica, or√©gano)"
    ],
    "instructions": "Misture 1 ovo, 2 colheres de milharina, 1 colher de √°gua para hidratar, 1 colher de chia ou linha√ßa, sal e temperos. Asse em frigideira ou potinho, virando para dourar. D√° para adaptar vers√µes proteica, doce ou 100% baixa energia.",
    "favorite": false,
    "photo": null,
    "link": null
  },
  {
    "id": "cafe-panqueca-banana-canela",
    "name": "ü•û Panqueca de banana + canela",
    "receita": "doce",
    "refeicao": "",
    "proteina": "ovo",
    "ingredients": [
      "banana (de prefer√™ncia 1/2 ou banana pequena)",
      "ovo",
      "aveia em flocos",
      "canela em p√≥",
      "pasta de amendoim (opcional)"
    ],
    "instructions": "‚ö†Ô∏è RI: usar ¬Ω banana ou banana pequena/verde. Amasse a banana, misture 1 ovo e 2 colheres de aveia + canela. Frite em fogo baixo. Opcional: 1 colher de pasta de amendoim sem a√ß√∫car para mais prote√≠na e fibra.",
    "favorite": false,
    "photo": null,
    "link": null
  },
  {
    "id": "cafe-ovos-mexidos-fruta",
    "name": "ü•ö Ovos mexidos + fruta",
    "receita": "salgado",
    "refeicao": "",
    "proteina": "ovo",
    "ingredients": [
      "ovos",
      "sal",
      "fruta de baixo IG (kiwi, morango, ma√ß√£ etc.)"
    ],
    "instructions": "Mexa 2 ovos com sal e sirva com 1 fruta de baixo √≠ndice glic√™mico (kiwi, morango, ma√ß√£, pera...). Combina√ß√£o √≥tima para RI.",
    "favorite": false,
    "photo": null,
    "link": null
  },
  {
    "id": "cafe-aveioca",
    "name": "ü•û Aveioca (aveia + ovo)",
    "receita": "salgado",
    "refeicao": "",
    "proteina": "ovo",
    "ingredients": [
      "ovo",
      "aveia em flocos",
      "sal",
      "c√∫rcuma (opcional)"
    ],
    "instructions": "Misture 1 ovo com 2 colheres de aveia e uma pitada de sal. Frite como uma crepioca. Dica anti-inflamat√≥ria: adicionar c√∫rcuma na massa.",
    "favorite": false,
    "photo": null,
    "link": null
  },
  {
    "id": "cafe-banana-castanhas",
    "name": "üçå Banana + castanhas (baixa energia)",
    "receita": "doce",
    "refeicao": "",
    "proteina": "veg",
    "ingredients": [
      "banana pequena",
      "castanhas (nozes, am√™ndoas, castanha-do-par√°)",
      "chia (opcional)"
    ],
    "instructions": "Corte a banana em rodelas, coloque castanhas por cima e, se quiser, 1 colher de ch√° de chia. Boa op√ß√£o para dias de baixa energia. Para RI, manter banana pequena.",
    "favorite": false,
    "photo": null,
    "link": null
  },
  {
    "id": "lanche-fruta-natural",
    "name": "ü•• Fruta ao natural",
    "receita": "doce",
    "refeicao": "",
    "proteina": "veg",
    "ingredients": [
      "frutas de baixo IG (kiwi, ma√ß√£, morango, pera)"
    ],
    "instructions": "Escolha 1 fruta de baixo √≠ndice glic√™mico. Dica: combinar com 1 castanha ajuda a segurar melhor a glicemia.",
    "favorite": false,
    "photo": null,
    "link": null
  },
  {
    "id": "lanche-castanhas",
    "name": "ü•ú Castanha-do-par√° / nozes",
    "receita": "salgado",
    "refeicao": "",
    "proteina": "veg",
    "ingredients": [
      "castanha-do-par√°",
      "nozes ou am√™ndoas"
    ],
    "instructions": "Comer 1‚Äì2 unidades como lanche. √ìtimo para RI, mas sem exagero para n√£o aumentar muito gordura total.",
    "favorite": false,
    "photo": null,
    "link": null
  },
  {
    "id": "lanche-creme-abacate",
    "name": "ü•ë Creme de abacate",
    "receita": "doce",
    "refeicao": "",
    "proteina": "veg",
    "ingredients": [
      "abacate",
      "lim√£o",
      "canela em p√≥"
    ],
    "instructions": "Amasse cerca de 1/2 abacate, tempere com lim√£o e canela. Lanche super anti-inflamat√≥rio e amigo da RI.",
    "favorite": false,
    "photo": null,
    "link": null
  },
  {
    "id": "lanche-vitamina-frutas-vermelhas",
    "name": "üçì Vitamina de frutas vermelhas + leite vegetal",
    "receita": "doce",
    "refeicao": "",
    "proteina": "veg",
    "ingredients": [
      "morangos (de prefer√™ncia congelados)",
      "leite vegetal (am√™ndoas, aveia, coco etc.)",
      "chia"
    ],
    "instructions": "Bata 1/2 x√≠cara de morangos com leite vegetal e 1 colher de ch√° de chia. Fica leve, refrescante e com bom controle glic√™mico.",
    "favorite": false,
    "photo": null,
    "link": null
  },
  {
    "id": "lanche-banana-cacau",
    "name": "üçå Banana + cacau 100%",
    "receita": "doce",
    "refeicao": "",
    "proteina": "veg",
    "ingredients": [
      "banana pequena",
      "cacau 100%",
      "canela em p√≥"
    ],
    "instructions": "Amasse a banana pequena, misture cacau 100% e canela. Lanche docinho sem a√ß√∫car refinado; para RI, manter por√ß√£o pequena.",
    "favorite": false,
    "photo": null,
    "link": null
  }
];


  
let recipes = [...INITIAL_RECIPES];

    let state = {
    recipes: [],
    weeklyPlans: [],
    selectedWeekIndex: 0,
    shoppingLists: {},
    startWeekdayIndex: 0,
    recipeStats: {},         // estat√≠sticas por receita
    mealCompliance: {}       // NOVO: acompanhamento das refei√ß√µes (segui/pulei/etc)
  };



     // ==== BACKUP (EXPORTAR / IMPORTAR) ====
  const btnBackupExport = document.getElementById("btnBackupExport");
  const btnBackupImport = document.getElementById("btnBackupImport");
  const backupFileInput = document.getElementById("backupFile");

  function exportBackup() {
    try {
      // monta s√≥ os dados importantes
      const data = {
  recipes: state.recipes || [],
  weeklyPlans: state.weeklyPlans || [],
  selectedWeekIndex:
    typeof state.selectedWeekIndex === "number" ? state.selectedWeekIndex : 0,
  shoppingLists: state.shoppingLists || {},
  startWeekdayIndex:
    typeof state.startWeekdayIndex === "number" ? state.startWeekdayIndex : 0,
  recipeStats: state.recipeStats || {},
  mealCompliance: state.mealCompliance || {}
};



      const raw = JSON.stringify(data, null, 2);

      // tenta baixar em arquivo .json
      try {
        if (window.Blob && window.URL && URL.createObjectURL) {
          const blob = new Blob([raw], { type: "application/json" });
          const url = URL.createObjectURL(blob);
          const a = document.createElement("a");
          a.href = url;
          a.download = "cardapio-backup.json";
          document.body.appendChild(a);
          a.click();
          a.remove();
          URL.revokeObjectURL(url);

          // mensagem simples pra sua m√£e
          alert("Backup gerado! Procure pelo arquivo 'cardapio-backup.json' na pasta de downloads.");
        } else {
          // fallback bem raro: mostra o texto do backup
          alert(
            "Seu navegador n√£o permite baixar o arquivo automaticamente.\n\n" +
            "Copie o texto a seguir e salve em um arquivo chamado 'cardapio-backup.json':\n\n" +
            raw
          );
        }
      } catch (e) {
        console.warn("Falha no download autom√°tico do backup:", e);
        alert(
          "N√£o foi poss√≠vel baixar o arquivo automaticamente.\n\n" +
          "Copie o texto a seguir e salve em um arquivo chamado 'cardapio-backup.json':\n\n" +
          raw
        );
      }
    } catch (e) {
      console.error(e);
      alert("Erro ao gerar o backup: " + (e.message || e));
    }
  }

  function importBackupFromFile(file) {
    const reader = new FileReader();
    reader.onload = function (ev) {
      try {
        const text = ev.target.result;
        // valida se √© JSON
        JSON.parse(text);
        // grava no localStorage
        localStorage.setItem(STORAGE_KEY, text);
renderResumoStats();
        alert("Backup restaurado com sucesso. O app ser√° recarregado.");
        location.reload();
      } catch (e) {
        console.error(e);
        alert("Arquivo de backup inv√°lido.");
      }
    };
    reader.readAsText(file);
  }

  if (btnBackupExport) {
    btnBackupExport.addEventListener("click", exportBackup);
  }

  if (btnBackupImport && backupFileInput) {
    btnBackupImport.addEventListener("click", () => {
      backupFileInput.value = "";
      backupFileInput.click();
    });

    backupFileInput.addEventListener("change", () => {
      const file = backupFileInput.files[0];
      if (!file) return;
      if (!file.name.endsWith(".json")) {
        alert("Escolha um arquivo .json de backup.");
        return;
      }
      importBackupFromFile(file);
    });
  }





  const mealTypes = ["almoco", "jantar", "lanche", "petisco"];
  let currentMealType = "almoco";

  let currentModalMode = null;
  let modalRecipeToAddId = null;

  function normalizeLink(url) {
    if (!url) return "";
    url = url.trim();
    if (!url) return "";
    if (/^https?:\/\//i.test(url)) return url;
    return "https://" + url;
  }

  const btnFontUp = document.getElementById("btnFontUp");
  const btnFontDown = document.getElementById("btnFontDown");
  let fontSize = 17;

  function applyFontSize() {
    document.documentElement.style.setProperty("--base-font-size", fontSize + "px");
    try {
      localStorage.setItem(FONT_KEY, String(fontSize));
    } catch (e) {
      console.warn("N√£o foi poss√≠vel salvar tamanho da fonte:", e);
    }
  }

  (function loadFontSize() {
    try {
      const stored = localStorage.getItem(FONT_KEY);
      if (stored) {
        const n = parseInt(stored, 10);
        if (!isNaN(n) && n >= 14 && n <= 22) fontSize = n;
      }
    } catch (e) {}
    applyFontSize();
  })();

  if (btnFontUp) {
    btnFontUp.addEventListener("click", () => {
      if (fontSize < 22) {
        fontSize++;
        applyFontSize();
      }
    });
  }

  if (btnFontDown) {
    btnFontDown.addEventListener("click", () => {
      if (fontSize > 14) {
        fontSize--;
        applyFontSize();
      }
    });
  }

  function createDefaultWeeklyPlans() {
    const arr = [];
    for (let i = 0; i < 14; i++) {
      arr.push({
        name: "Dia " + (i + 1),
        almoco: [],
        jantar: [],
        lanche: [],
        petisco: []
      });
    }
    return arr;
  }

  function generateId() {
    return Date.now().toString(36) + Math.random().toString(36).slice(2, 8);
  }

function normalizeRecipes(rawRecipes) {
  if (!Array.isArray(rawRecipes)) return [];

  const validMealTypes = ["principal", "cafe", "sobremesa", "lanche", "ceia", "petisco", "saladas", "molhos", "temperos"];

  return rawRecipes.map((raw) => {
    const copy = { ...raw };

    // Garante ID
    if (!copy.id) {
      copy.id = Date.now().toString(36) + Math.random().toString(36).slice(2, 8);
    }

    // -------- 1. TIPO DE RECEITA (salgado / doce) --------
    // Pode vir como: raw.receita, raw.kind, raw.tipo, etc.
    let receitaRaw =
      (raw.receita ?? raw.kind ?? raw.tipo ?? "").toString().trim().toLowerCase();

    let receita;
    if (receitaRaw.includes("doce")) receita = "doce";
    else if (receitaRaw.includes("salg")) receita = "salgado";
    else {
      // fallback: tenta deduzir pelo nome/ingredientes
      const fullText = `${raw.name || ""} ${(raw.ingredients || []).join(" ")}`.toLowerCase();
      if (fullText.includes("bolo") || fullText.includes("torta") || fullText.includes("doce")) {
        receita = "doce";
      } else {
        receita = "salgado";
      }
    }

    copy.receita = receita; // campo em portugu√™s
    copy.kind = receita;    // mant√©m compat√≠vel com o resto do c√≥digo

    // -------- 2. TIPO DE REFEI√á√ÉO (principal, caf√©, sobremesa, lanche, ceia, petisco, saladas, molhos, temperos) --------
    // Pode vir como: raw.refeicao, raw.work, raw.mealType, etc.
    let refeicaoRaw =
      (raw.refeicao ?? raw.work ?? raw.mealType ?? "").toString().trim().toLowerCase();

    // Normaliza alguns textos
    if (refeicaoRaw.includes("caf√©")) refeicaoRaw = "cafe";
    if (refeicaoRaw.includes("lanche")) refeicaoRaw = "lanche";
    if (refeicaoRaw.includes("sobrem")) refeicaoRaw = "sobremesa";
    if (refeicaoRaw.includes("petisc")) refeicaoRaw = "petisco";
    if (refeicaoRaw.includes("ceia")) refeicaoRaw = "ceia";

    let refeicao;
    if (validMealTypes.includes(refeicaoRaw)) {
      refeicao = refeicaoRaw;
    } else {
      // fallback:
      // se √© doce ‚Üí assume sobremesa; sen√£o ‚Üí principal
      refeicao = receita === "doce" ? "sobremesa" : "principal";
    }

    copy.refeicao = refeicao; // campo em portugu√™s
    copy.work = refeicao;     // mant√©m compat√≠vel com o resto do c√≥digo

    // -------- 3. PROTE√çNA PRINCIPAL --------
    // Pode vir como: raw.proteina, raw.protein, etc.
    const proteinMap = {
      frango: "frango",
      "frango/peru": "frango",
      peru: "frango",
      galinha: "frango",
      carne: "boi",
      bovina: "boi",
      boi: "boi",
      vaca: "boi",
      suina: "porco",
      su√≠no: "porco",
      suino: "porco",
      porco: "porco",
      peixe: "peixe",
      atum: "peixe",
      salmao: "peixe",
      salm√£o: "peixe",
      bacalhau: "peixe",
      tilapia: "peixe",
      til√°pia: "peixe",
      ovo: "ovo",
      ovos: "ovo",
      queijo: "latic√≠neos",
      ricota: "latic√≠neos",
      requeijao: "latic√≠neos",
      requeij√£o: "latic√≠neos",
      leite: "latic√≠neos",
      iogurte: "latic√≠neos",
      laticinio: "latic√≠neos",
      latic√≠nio: "latic√≠neos",
      laticinios: "latic√≠neos",
      latic√≠nios: "latic√≠neos",
      veg: "veg",
      vegetal: "veg",
      leguminosa: "veg",
      legumes: "veg",
      legume: "veg",
      misto: "veg"
    };

    let proteinaRaw =
      (raw.proteina ?? raw.protein ?? "").toString().trim().toLowerCase();

    let proteina;
    if (proteinaRaw) {
      proteina = proteinMap[proteinaRaw] || "veg";
    } else {
      // tenta deduzir pela descri√ß√£o
      const fullText = `${raw.name || ""} ${(raw.ingredients || []).join(" ")}`.toLowerCase();

      if (/\bfrango\b|\bperu\b|\bgalinha\b/.test(fullText)) {
        proteina = "frango";
      } else if (/\bporco\b|\bsu√≠n|suin/.test(fullText)) {
        proteina = "porco";
      } else if (/\bcarne\b|\bbife\b|\bpatinho\b|\bcox√£o\b/.test(fullText)) {
        proteina = "boi";
      } else if (/\bpeixe\b|\batum\b|\bsalm[a√£]o\b|\bbacalhau\b/.test(fullText)) {
        proteina = "peixe";
      } else if (/\bovo\b|\bovos\b/.test(fullText)) {
        proteina = "ovo";
      } else if (/\bqueijo\b|\bricota\b|\brequeij[a√£]o\b|\bleite\b|\biogurte\b/.test(fullText)) {
        proteina = "latic√≠neos";
      } else {
        proteina = "veg";
      }
    }

    copy.proteina = proteina; // campo em portugu√™s
    copy.protein = proteina;  // mant√©m compat√≠vel com o resto do c√≥digo

    // -------- 4. INGREDIENTES --------
    if (!Array.isArray(copy.ingredients)) {
      if (typeof copy.ingredients === "string") {
        copy.ingredients = copy.ingredients
          .split("\n")
          .map((t) => t.trim())
          .filter(Boolean);
      } else {
        copy.ingredients = [];
      }
    }

    // -------- 5. INSTRU√á√ïES --------
    copy.instructions = (copy.instructions || "").toString();

    // -------- 6. POR√á√ïES --------
    if (!copy.servings || isNaN(copy.servings)) {
      copy.servings = 0;
    }

    // -------- 7. FAVORITA --------
    if (typeof copy.favorite !== "boolean") {
      copy.favorite = false;
    }

    // -------- 8. LINK --------
    if (!copy.link) copy.link = "";

    // -------- 9. FOTO --------
    if (!("photo" in copy)) {
      copy.photo = null;
    }

    return copy;
  });
}
  




  function saveState() {
    try {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
    } catch (e) {
      console.warn("N√£o foi poss√≠vel salvar no localStorage:", e);
    }
  }

    function loadState() {
    try {
      const raw = localStorage.getItem(STORAGE_KEY);
      if (raw) {
        const parsed = JSON.parse(raw);
        state.recipes = parsed.recipes || [];
        state.weeklyPlans = parsed.weeklyPlans || [];
        state.selectedWeekIndex = parsed.selectedWeekIndex || 0;
        state.shoppingLists = parsed.shoppingLists || {};
        state.startWeekdayIndex = parsed.startWeekdayIndex ?? 3; // se quiser fixar na quinta
        state.recipeStats = parsed.recipeStats || {};
        state.mealCompliance =
          (parsed.mealCompliance && typeof parsed.mealCompliance === "object")
            ? parsed.mealCompliance
            : {};

        state.recipes = normalizeRecipes(state.recipes);
        normalizeWeeklyPlans();
        normalizeShoppingLists();
      } else {
        // estado inicial
        state.recipes = INITIAL_RECIPES.map((r, idx) => ({
          ...r,
          id: "r" + (idx + 1),
          favorite: false
        }));
        state.weeklyPlans = createDefaultWeeklyPlans(); // 10 ou 14 dias ‚Äì o que voc√™ j√° estiver usando
        state.shoppingLists = {};
        state.startWeekdayIndex = 3; // Dia 1 = quinta
        state.recipeStats = {};
        state.mealCompliance = {};

        state.recipes = normalizeRecipes(state.recipes);
        normalizeWeeklyPlans();
        normalizeShoppingLists();
      }
    } catch (e) {
      console.error(e);
    }
  }


  function getRecipeById(id) {
    return state.recipes.find(r => r.id === id) || null;
  }

  function removeRecipeFromWeeks(recipeId) {
    state.weeklyPlans.forEach(wp => {
      mealTypes.forEach(m => {
        wp[m] = wp[m].filter(id => id !== recipeId);
      });
    });
  }

  function kindLabel(kind) {
    if (kind === "doce") return "Doce";
    return "Salgado";
  }

     function workLevelLabel(work) {
      switch (work) {
        case "principal":
          return "üçΩ Refei√ß√£o principal";
        case "cafe":
          return "‚òï Caf√©";
        case "sobremesa":
          return "üç∞ Sobremesa";
        case "lanche":
          return "‚òÄÔ∏è Lanche";
        case "ceia":
          return "üåí Ceia";
        case "petisco":
          return "üç∑ Petisco";
        default:
          return work || "";
      }
    }



  function mealLabel(m) {
    if (m === "almoco") return "üçõ Almo√ßo";
    if (m === "jantar") return "üçΩ Jantar";
    if (m === "lanche") return "‚òï Lanches";
    if (m === "petisco") return "üç∑ Petiscos com vinho";
    return m;
  }

  // Dia 1 (√≠ndice 0) = Quinta, igual √† Rotina 14 dias
function weekdayForDayIndex(dayIndex) {
  const fixedStartIndex = 3; // 0=Seg, 1=Ter, 2=Qua, 3=Qui
  const idx = (fixedStartIndex + (dayIndex % 7) + 7) % 7;
  return WEEKDAYS_SHORT[idx];
}


  const tabButtons = document.querySelectorAll(".tab-btn");
  const tabPanels = document.querySelectorAll(".tab-panel");

  tabButtons.forEach(btn => {
    btn.addEventListener("click", () => {
      const targetId = btn.dataset.tab;
      tabButtons.forEach(b => b.classList.remove("active"));
      tabPanels.forEach(p => p.classList.remove("active"));
      btn.classList.add("active");
      document.getElementById(targetId).classList.add("active");
    });
  });

  const recipesListEl = document.getElementById("recipesList");
  const btnNovaReceita = document.getElementById("btnNovaReceita");
  const recipeFormCard = document.getElementById("recipeFormCard");
  const recipeForm = document.getElementById("recipeForm");
  const recipeFormTitle = document.getElementById("recipeFormTitle");
  const btnCancelarReceita = document.getElementById("btnCancelarReceita");

  const fieldName = document.getElementById("recipeName");
  const fieldKind = document.getElementById("recipeKind");
  const fieldWork = document.getElementById("recipeWork");
  const fieldServings = document.getElementById("recipeServings");
  const fieldProtein = document.getElementById("recipeProtein");
  const fieldIngredients = document.getElementById("recipeIngredients");
  const fieldInstructions = document.getElementById("recipeInstructions");
  const fieldPhoto = document.getElementById("recipePhoto");
  const fieldLink = document.getElementById("recipeLink");

  const filterFav = document.getElementById("filterFav");
  const recipeSearch = document.getElementById("recipeSearch");

  const photoOverlay = document.getElementById("photoOverlay");
  const photoOverlayImg = document.getElementById("photoOverlayImg");

  let currentEditingRecipeId = null;

  function openPhoto(src, alt) {
    if (!src) return;
    photoOverlayImg.src = src;
    photoOverlayImg.alt = alt || "Foto da receita";
    photoOverlay.classList.add("active");
  }

  if (photoOverlay) {
    photoOverlay.addEventListener("click", () => {
      photoOverlay.classList.remove("active");
    });
  }

  function renderRecipesList() {
    recipesListEl.innerHTML = "";

    if (!state.recipes.length) {
      const p = document.createElement("p");
      p.className = "small";
      p.textContent = "Nenhuma receita cadastrada ainda. Clique em ‚ÄúNova receita‚Äù para come√ßar.";
      recipesListEl.appendChild(p);
      return;
    }

    const fFilter = filterFav ? filterFav.value : "";
    const searchTerm = recipeSearch.value.trim().toLowerCase();

    const filtered = state.recipes.filter(r => {
      if (fFilter === "salgado" && r.kind !== "salgado") return false;
      if (fFilter === "doce" && r.kind !== "doce") return false;
      if (fFilter === "fav" && !r.favorite) return false;

      const ingredientsText = Array.isArray(r.ingredients)
        ? r.ingredients.join(" ")
        : (r.ingredients || "");
      if (searchTerm) {
        const haystack =
          (r.name || "") + " " +
          ingredientsText + " " +
          (r.instructions || "") + " " +
          (r.link || "") + " " +
          (r.kind || "");
        if (!haystack.toLowerCase().includes(searchTerm)) return false;
      }

      return true;
    });

    if (!filtered.length) {
      const p = document.createElement("p");
      p.className = "small";
      p.textContent = "Nenhuma receita encontrado com esses filtros ou busca.";
      recipesListEl.appendChild(p);
      return;
    }

    filtered.forEach(r => {
      const card = document.createElement("div");
      card.className = "recipe-card";

      const top = document.createElement("div");
      top.className = "recipe-top";

      if (r.photo) {
        const img = document.createElement("img");
        img.className = "recipe-photo";
        img.src = r.photo;
        img.alt = r.name;
        img.addEventListener("click", () => openPhoto(r.photo, r.name));
        top.appendChild(img);
      }

      const main = document.createElement("div");
      main.className = "recipe-main";

      const nameEl = document.createElement("div");
      nameEl.className = "recipe-name";
      nameEl.textContent = r.name;

      const metaEl = document.createElement("div");
      metaEl.className = "recipe-meta";
      metaEl.textContent =
        kindLabel(r.kind) + " ‚Ä¢ " +
        workLevelLabel(r.work) +
        (r.servings ? " ‚Ä¢ " + r.servings + " por√ß√µes" : "");

      main.appendChild(nameEl);
      main.appendChild(metaEl);

      if (r.link) {
        const linkRow = document.createElement("div");
        linkRow.className = "recipe-link-inline small";
        const a = document.createElement("a");
        a.href = normalizeLink(r.link);
        a.target = "_blank";
        a.rel = "noopener noreferrer";
        a.textContent = "üîó Abrir receita";
        linkRow.appendChild(a);
        main.appendChild(linkRow);
      }

      top.appendChild(main);

      const actions = document.createElement("div");
      actions.className = "recipe-actions";

      const detailsBtn = document.createElement("button");
      detailsBtn.className = "btn sm";
      detailsBtn.dataset.action = "details";
      detailsBtn.dataset.id = r.id;
      detailsBtn.textContent = "üôà";

      const favBtn = document.createElement("button");
      favBtn.className = "btn sm";
      favBtn.dataset.action = "fav";
      favBtn.dataset.id = r.id;
      favBtn.textContent = r.favorite ? "‚≠êÔ∏è" : "‚òÜ";

      const addDayBtn = document.createElement("button");
      addDayBtn.className = "btn sm";
      addDayBtn.dataset.action = "add-to-day";
      addDayBtn.dataset.id = r.id;
      addDayBtn.textContent = "üìÖ";

      const editBtn = document.createElement("button");
      editBtn.className = "btn sm";
      editBtn.dataset.action = "edit";
      editBtn.dataset.id = r.id;
      editBtn.textContent = "‚úèÔ∏è";

      const delBtn = document.createElement("button");
      delBtn.className = "btn sm danger";
      delBtn.dataset.action = "delete";
      delBtn.dataset.id = r.id;
      delBtn.textContent = "üóë";

      actions.appendChild(detailsBtn);
      actions.appendChild(favBtn);
      actions.appendChild(addDayBtn);
      actions.appendChild(editBtn);
      actions.appendChild(delBtn);

      const details = document.createElement("div");
      details.className = "recipe-details";
      details.style.display = "none";

      if (Array.isArray(r.ingredients) && r.ingredients.length) {
        const ingTitle = document.createElement("div");
        ingTitle.className = "section-title";
        ingTitle.textContent = "Ingredientes";

        const ingList = document.createElement("ul");
        r.ingredients.forEach(ing => {
          const li = document.createElement("li");
          li.textContent = ing;
          ingList.appendChild(li);
        });

        details.appendChild(ingTitle);
        details.appendChild(ingList);
      }

      if (r.instructions) {
        const instrTitle = document.createElement("div");
        instrTitle.className = "section-title";
        instrTitle.textContent = "Modo de preparo";

        const instrText = document.createElement("p");
        instrText.className = "small";
        instrText.style.whiteSpace = "pre-wrap";
        instrText.textContent = r.instructions || "";

        details.appendChild(instrTitle);
        details.appendChild(instrText);
      }

      

      card.appendChild(top);
      card.appendChild(actions);
      card.appendChild(details);

      recipesListEl.appendChild(card);
    });
  }

  function openRecipeForm(isEdit, recipe) {
    recipeFormCard.style.display = "block";
    recipeForm.scrollIntoView({ behavior: "smooth", block: "start" });

    if (isEdit && recipe) {
  recipeFormTitle.textContent = "Editar receita";
  fieldName.value = recipe.name || "";
  fieldKind.value = recipe.receita || "salgado";
  fieldWork.value = recipe.work || "principal";
  fieldServings.value = recipe.servings || 3;
  fieldIngredients.value = Array.isArray(recipe.ingredients)
    ? recipe.ingredients.join("\n")
    : (recipe.ingredients || "");
  fieldInstructions.value = recipe.instructions || "";
  fieldLink.value = recipe.link || "";
  fieldPhoto.value = "";
  if (fieldProtein) {
    fieldProtein.value = recipe.proteina || "veg";
  }
} else {
  recipeFormTitle.textContent = "Nova receita";
  recipeForm.reset();
  fieldKind.value = "salgado";
  fieldWork.value = "principal";
  fieldServings.value = 3;
  fieldLink.value = "";
  if (fieldProtein) {
    fieldProtein.value = "veg";
  }
}

}
  function closeRecipeForm() {
    recipeFormCard.style.display = "none";
    currentEditingRecipeId = null;
  }

  if (btnNovaReceita) {
    btnNovaReceita.addEventListener("click", () => {
      currentEditingRecipeId = null;
      openRecipeForm(false, null);
    });
  }

  if (btnCancelarReceita) {
    btnCancelarReceita.addEventListener("click", () => {
      closeRecipeForm();
    });
  }

  recipesListEl.addEventListener("click", (e) => {
    const btn = e.target.closest("button");
    if (!btn) return;
    const action = btn.dataset.action;
    const id = btn.dataset.id;
    if (!action || !id) return;

    const recipe = getRecipeById(id);
    if (!recipe) return;

    if (action === "edit") {
      currentEditingRecipeId = id;
      openRecipeForm(true, recipe);
    } else if (action === "delete") {
      if (confirm("Tem certeza que deseja excluir esta receita?")) {
        state.recipes = state.recipes.filter(r => r.id !== id);
        removeRecipeFromWeeks(id);
        saveState();
        renderRecipesList();
        renderWeekView();
      }
    } else if (action === "fav") {
      recipe.favorite = !recipe.favorite;
      btn.textContent = recipe.favorite ? "‚≠êÔ∏è" : "‚òÜ";
      saveState();
    } else if (action === "details") {
      const card = btn.closest(".recipe-card");
      if (!card) return;
      const detailsEl = card.querySelector(".recipe-details");
      if (!detailsEl) return;
      const isVisible = detailsEl.style.display === "block";
      detailsEl.style.display = isVisible ? "none" : "block";
      btn.textContent = isVisible ? "üôà" : "üêµ";
    } else if (action === "add-to-day") {
      openAddToDayModal(id, recipe.name);
    }
  });

  [filterFav, recipeSearch].forEach(el => {
    if (!el) return;
    el.addEventListener("input", renderRecipesList);
    el.addEventListener("change", renderRecipesList);
  });

  recipeForm.addEventListener("submit", (e) => {
    e.preventDefault();

    const name = fieldName.value.trim();
    if (!name) {
      alert("Informe um nome para a receita.");
      return;
    }

    const ingredientsLines = fieldIngredients.value
      .split("\n")
      .map(l => l.trim())
      .filter(Boolean);

   const baseRecipe = {
  name,
  kind: fieldKind.value || "salgado",
  work: fieldWork.value || "principal",   // agora: tipo de refei√ß√£o
  protein: fieldProtein ? (fieldProtein.value || "veg") : "veg",
  servings: Number(fieldServings.value) || 3,
  ingredients: ingredientsLines,
  instructions: fieldInstructions.value.trim(),
  link: normalizeLink(fieldLink.value)
};


    const file = fieldPhoto.files[0];

    function finishSave(photoDataUrl) {
      if (photoDataUrl) baseRecipe.photo = photoDataUrl;

      if (currentEditingRecipeId) {
        const idx = state.recipes.findIndex(r => r.id === currentEditingRecipeId);
        if (idx >= 0) {
          const existing = state.recipes[idx];
          state.recipes[idx] = {
            ...existing,
            ...baseRecipe,
            favorite: existing.favorite,
            photo: photoDataUrl || existing.photo || null
          };
        }
      } else {
        baseRecipe.id = generateId();
        baseRecipe.favorite = false;
        baseRecipe.photo = baseRecipe.photo || null;
        state.recipes.push(baseRecipe);
      }

      state.recipes = normalizeRecipes(state.recipes);
      saveState();

      if (filterFav) filterFav.value = "";
      if (recipeSearch) recipeSearch.value = "";

      renderRecipesList();
      renderWeekView();
      closeRecipeForm();
    }

    if (file) {
      const reader = new FileReader();
      reader.onload = function(ev) {
        finishSave(ev.target.result);
      };
      reader.readAsDataURL(file);
    } else {
      finishSave(null);
    }
  });

  const weekSelect = document.getElementById("weekSelect");
  const mealSelect = document.getElementById("mealSelect");
  const startWeekdaySelect = document.getElementById("startWeekdaySelect");
  const currentMealTitle = document.getElementById("currentMealTitle");
  const dayMealsContainer = document.getElementById("dayMealsContainer");
  const btnOpenRotinaForDay = document.getElementById("btnOpenRotinaForDay");

  const btnEditCurrentMeal = document.getElementById("btnEditCurrentMeal");
  const btnClearDay = document.getElementById("btnClearDay");
  const weekdayLabel = document.getElementById("weekdayLabel");

  
  // ===== SUGEST√ïES ‚Äì ELEMENTOS DA TELA =====
const suggestContextText = document.getElementById("suggestContextText");
const suggestProtein = document.getElementById("suggestProtein");
const suggestWork = document.getElementById("suggestWork");
const suggestKind = document.getElementById("suggestKind");
const suggestFavOnly = document.getElementById("suggestFavOnly");
const suggestAvoidRecent = document.getElementById("suggestAvoidRecent");
const btnMostrarTudo = document.getElementById("btnMostrarTudo");

const btnGerarSugestoes = document.getElementById("btnGerarSugestoes");
const btnVisitasEmCasa = document.getElementById("btnVisitasEmCasa");
const btnTenhoIngredientes = document.getElementById("btnTenhoIngredientes");


const suggestionsContainer = document.getElementById("suggestionsContainer");

if (btnMostrarTudo) {
  btnMostrarTudo.addEventListener("click", applyFilteredRecipesFromSuggest);
}

// guarda ids de receitas recusadas na rodada atual
let lastSuggestionIgnoredIds = [];

// Estat√≠sticas por receita
function getRecipeStats(id) {
  if (!state.recipeStats || typeof state.recipeStats !== "object") {
    state.recipeStats = {};
  }
  if (!state.recipeStats[id]) {
    state.recipeStats[id] = {
      usedCount: 0,
      rejectedCount: 0,
      lastUsedDay: null
    };
  }
  return state.recipeStats[id];
}

function updateSuggestContextText() {
  if (!suggestContextText) return;
  const dayIdx = state.selectedWeekIndex || 0;
  const dayNumber = dayIdx + 1;
  const wd = weekdayForDayIndex(dayIdx);
  const mealName = mealLabel(currentMealType);
  suggestContextText.textContent = `Usando: Dia ${dayNumber} (${wd}) ‚Ä¢ ${mealName}`;
}
  

 // ==== CALEND√ÅRIO DO CARD√ÅPIO ====
  const btnVerCalendario = document.getElementById("btnVerCalendario");
  const calendarOverlay = document.getElementById("calendarOverlay");
  const calendarContent = document.getElementById("calendarContent");
  const calendarClose = document.getElementById("calendarClose");

  const calendarMealTypes = ["almoco", "lanche", "jantar", "petisco"];

  function buildDayMealsText(dayPlan) {
    const lines = [];

    calendarMealTypes.forEach(mt => {
      const ids = dayPlan[mt] || [];
      if (!ids.length) return;

      let label = "";
      if (mt === "almoco") label = "Almo√ßo";
      else if (mt === "lanche") label = "Lanches";
      else if (mt === "jantar") label = "Jantar";
      else if (mt === "petisco") label = "Petiscos com vinho";

      const names = ids
        .map(id => {
          const r = getRecipeById(id);
          return r ? r.name : "(receita removida)";
        })
        .join(", ");

      lines.push(`<strong>${label}:</strong> ${names}`);
    });

    if (!lines.length) {
      return '<span class="small">Nenhuma receita escolhida para este dia.</span>';
    }

    return lines.join("<br>");
  }

  function renderCalendarView() {
    if (!state.weeklyPlans || !state.weeklyPlans.length) {
      calendarContent.innerHTML =
        '<p class="small">Nenhum dia de card√°pio foi configurado ainda.</p>';
      return;
    }

    let html = '<div style="display:flex; flex-direction:column; gap:0.75rem;">';

    state.weeklyPlans.forEach((dayPlan, index) => {
      const dayNumber = index + 1;
      const weekdayLabel = weekdayForDayIndex(index); // usa o que voc√™ j√° tem
      const mealsHtml = buildDayMealsText(dayPlan);

      html += `
        <div style="border:1px solid var(--border); border-radius:8px; padding:0.5rem 0.75rem;">
          <div class="section-title">Dia ${dayNumber} (${weekdayLabel})</div>
          <div class="small">${mealsHtml}</div>
        </div>
      `;
    });

    html += "</div>";
    calendarContent.innerHTML = html;
  }

  if (btnVerCalendario && calendarOverlay && calendarContent) {
    btnVerCalendario.addEventListener("click", () => {
      renderCalendarView();
      calendarOverlay.classList.add("active");
    });
  }

  if (calendarClose) {
    calendarClose.addEventListener("click", () => {
      calendarOverlay.classList.remove("active");
    });
  }

  if (calendarOverlay) {
    calendarOverlay.addEventListener("click", (e) => {
      if (e.target === calendarOverlay) {
        calendarOverlay.classList.remove("active");
      }
    });
  }

  const modalOverlay = document.getElementById("modalOverlay");
  const modalTitle = document.getElementById("modalTitle");
  const modalContent = document.getElementById("modalContent");
  const modalCancel = document.getElementById("modalCancel");
  const modalSave = document.getElementById("modalSave");
  
  // ===== ALGORITMO DE SUGEST√ÉO =====
// ===== ALGORITMO DE SUGEST√ÉO (CORRIGIDO) =====
function buildSuggestions(ignoredIds, extra) {
  const ignoredSet = new Set(ignoredIds || []);

  const proteinFilter = suggestProtein ? suggestProtein.value : "tanto-faz";
  const workFilter = suggestWork ? suggestWork.value : "tanto-faz";
  const kindFilter = suggestKind ? suggestKind.value : "tanto-faz";
  const favOnly = suggestFavOnly && suggestFavOnly.checked;
  const avoidRecent = suggestAvoidRecent && suggestAvoidRecent.checked;

  const currentDayIndex = state.selectedWeekIndex || 0;

  // filtro extra opcional por ingredientes (bot√£o "Tenho esses ingredientes")
  const ingredientsTokens =
    extra && Array.isArray(extra.ingredientsTokens) ? extra.ingredientsTokens : null;

  // 1) filtrar receitas
  let candidates = (state.recipes || []).filter(r => {
    if (!r) return false;

    if (ignoredSet.has(r.id)) return false;

    // filtro por prote√≠na
    if (proteinFilter !== "tanto-faz" && r.protein !== proteinFilter) {
      return false;
    }

    // filtro por tipo (salgado/doce)
    if (kindFilter !== "tanto-faz" && r.kind !== kindFilter) {
      return false;
    }

    // filtro por n√≠vel de trabalho
    if (workFilter !== "tanto-faz" && r.work !== workFilter) {
      return false;
    }

    // s√≥ favoritas, se marcado
    if (favOnly && !r.favorite) {
      return false;
    }

    // filtro por ingredientes digitados
    if (ingredientsTokens && ingredientsTokens.length) {
      const ingText = Array.isArray(r.ingredients) ? r.ingredients.join(" ") : (r.ingredients || "");
      const hay = ((r.name || "") + " " + ingText).toLowerCase();
      const ok = ingredientsTokens.some(t => hay.includes(t));
      if (!ok) return false;
    }

    return true;
  });

  if (!candidates.length) return [];

  // 2) score
  const scored = candidates.map(r => {
    const stats = getRecipeStats(r.id);
    let score = 0;

    // b√¥nus por match forte
    if (proteinFilter !== "tanto-faz" && r.protein === proteinFilter) score += 3;
    if (kindFilter !== "tanto-faz" && r.kind === kindFilter) score += 2;

    // tipo de refei√ß√£o ‚Äî pequeno b√¥nus se combinar com o filtro
if (workFilter !== "tanto-faz" && r.work === workFilter) {
  score += 2;
}


    // favoritas
    if (r.favorite) score += 2;

    // evitar repeti√ß√£o recente
    if (avoidRecent && typeof stats.lastUsedDay === "number") {
      const diff = Math.abs(currentDayIndex - stats.lastUsedDay);
      if (diff <= 1) score -= 4;
      else if (diff <= 3) score -= 2;
    }

    // se voc√™ recusa muito essa receita
    if (stats.rejectedCount > stats.usedCount + 1) score -= 2;

    // pequena aleatoriedade
    score += Math.random() * 0.5;

    return { recipe: r, score };
  });

  scored.sort((a, b) => b.score - a.score);

  return scored.slice(0, 3).map(x => x.recipe);
}


function getSuggestFilters() {
  // Esses IDs devem ser os mesmos que voc√™ j√° usa na aba sugest√µes
  const kind = (suggestKind && suggestKind.value) ? suggestKind.value : "tanto-faz";
  const work = (suggestWork && suggestWork.value) ? suggestWork.value : "tanto-faz";
  const protein = (suggestProtein && suggestProtein.value) ? suggestProtein.value : "tanto-faz";

  const favOnly = !!(suggestFavOnly && suggestFavOnly.checked);
  const avoidRecent = !!(suggestAvoidRecent && suggestAvoidRecent.checked);

  return { kind, work, protein, favOnly, avoidRecent };
}

function applySuggestFiltersToList(list) {
  const f = getSuggestFilters(); // usa o que voc√™ j√° tem: tipo, refei√ß√£o, prote√≠na, etc.

  let filtered = Array.isArray(list) ? [...list] : [];

  // --- 1. TIPO DE RECEITA (salgado / doce) ---
  if (f.kind && f.kind !== "tanto-faz") {
    filtered = filtered.filter((r) => {
      const tipo = r.receita || r.kind || "salgado";
      return tipo === f.kind;
    });
  }

  // --- 2. TIPO DE REFEI√á√ÉO (principal, caf√©, sobremesa, lanche, ceia, petisco, saladas, molhos, temperos) ---
  if (f.work && f.work !== "tanto-faz") {
    filtered = filtered.filter((r) => {
      const refeicao = r.refeicao || r.work || "principal";
      return refeicao === f.work;
    });
  }

  // --- 3. PROTE√çNA PRINCIPAL ---
  if (f.protein && f.protein !== "tanto-faz") {
    filtered = filtered.filter((r) => {
      const prot = r.proteina || r.protein || "veg";
      return prot === f.protein;
    });
  }

  // --- 4. Somente favoritas (se marcado) ---
  if (f.favOnly) {
    filtered = filtered.filter((r) => !!r.favorite);
  }

  // --- 5. Evitar repetir √∫ltimos dias (se marcado) ---
  if (f.avoidRecent) {
    const dayIdx = state.selectedWeekIndex || 0;
    filtered = filtered.filter((r) => {
      const st = getRecipeStats(r.id);
      if (typeof st.lastUsedDay !== "number") return true;
      return Math.abs(dayIdx - st.lastUsedDay) > 1;
    });
  }

  return filtered;
}


function applyFilteredRecipesFromSuggest() {
  lastSuggestionIgnoredIds = []; // zera recusas da rodada
  const filtered = applySuggestFiltersToList(state.recipes || []);
  renderSuggestions(filtered);
}




function renderSuggestions(recipes) {
  if (!suggestionsContainer) return;
  suggestionsContainer.innerHTML = "";

  if (!recipes || !recipes.length) {
    const p = document.createElement("p");
    p.className = "small";
    p.textContent = "N√£o encontrei receitas com esses filtros. Tente mudar a prote√≠na, o tipo ou o n√≠vel de trabalho.";

    suggestionsContainer.appendChild(p);
    return;
  }

  recipes.forEach((r, index) => {
    const card = document.createElement("div");
    card.className = "recipe-card";

    const top = document.createElement("div");
    top.className = "recipe-top";

    const main = document.createElement("div");
    main.className = "recipe-main";

    const nameEl = document.createElement("div");
    nameEl.className = "recipe-name";
    nameEl.textContent = `${index + 1}Ô∏è‚É£ ${r.name}`;

    const metaEl = document.createElement("div");
    metaEl.className = "recipe-meta";

    const proteinLabel = r.protein || "‚Äî";
const typeLabel = workLevelLabel(r.work);

metaEl.textContent =
  `prote√≠na: ${proteinLabel} ‚Ä¢ ${typeLabel}` +
  (r.favorite ? " ‚Ä¢ ‚≠ê favorita" : "");


    main.appendChild(nameEl);
    main.appendChild(metaEl);

    top.appendChild(main);
    card.appendChild(top);

    // bot√µes
    const actions = document.createElement("div");
    actions.className = "recipe-actions";

    const useBtn = document.createElement("button");
    useBtn.className = "btn sm primary";
    useBtn.dataset.action = "suggest-use";
    useBtn.dataset.id = r.id;
    useBtn.textContent = "Usar nesta refei√ß√£o";

    const nextBtn = document.createElement("button");
    nextBtn.className = "btn sm";
    nextBtn.dataset.action = "suggest-next";
    nextBtn.dataset.id = r.id;
    nextBtn.textContent = "Outra op√ß√£o";

    actions.appendChild(useBtn);
    actions.appendChild(nextBtn);

    card.appendChild(actions);

    // se quiser, pode mostrar link
    if (r.link) {
      const linkRow = document.createElement("div");
      linkRow.className = "recipe-link-inline small";
      const a = document.createElement("a");
      a.href = normalizeLink(r.link);
      a.target = "_blank";
      a.rel = "noopener noreferrer";
      a.textContent = "üîó Abrir receita";
      linkRow.appendChild(a);
      card.appendChild(linkRow);
    }

    suggestionsContainer.appendChild(card);
  });
}



if (suggestionsContainer) {
  suggestionsContainer.addEventListener("click", (e) => {
    const btn = e.target.closest("button");
    if (!btn) return;
    const action = btn.dataset.action;
    const id = btn.dataset.id;
    if (!action || !id) return;

    if (action === "suggest-use") {
      // adicionar receita na refei√ß√£o atual (dia + tipo)
      if (!state.weeklyPlans || !state.weeklyPlans.length) {
        state.weeklyPlans = createDefaultWeeklyPlans();
      }
      const dayIdx = state.selectedWeekIndex || 0;
      const wp = state.weeklyPlans[dayIdx] || {
        almoco: [], jantar: [], lanche: [], petisco: []
      };
      if (!Array.isArray(wp[currentMealType])) {
        wp[currentMealType] = [];
      }
      if (!wp[currentMealType].includes(id)) {
        wp[currentMealType].push(id);
      }
      state.weeklyPlans[dayIdx] = wp;

      const stats = getRecipeStats(id);
      stats.usedCount++;
      stats.lastUsedDay = dayIdx;

      saveState();
      renderWeekView();

      alert("Receita adicionada em " +
        `Dia ${dayIdx + 1} ‚Äì ${mealLabel(currentMealType)}.`);
    }

    if (action === "suggest-next") {
      // marcar como recusada e gerar nova sugest√£o
      const stats = getRecipeStats(id);
      stats.rejectedCount++;
      lastSuggestionIgnoredIds.push(id);
      saveState();

      const recs = buildSuggestions(lastSuggestionIgnoredIds);
      renderSuggestions(recs);
    }
  });
}






function generateSuggestionsNow(extra) {
  lastSuggestionIgnoredIds = [];
  const recs = buildSuggestions(lastSuggestionIgnoredIds, extra);
  renderSuggestions(recs);
}

if (btnGerarSugestoes) {
  btnGerarSugestoes.addEventListener("click", () => {
    generateSuggestionsNow();
  });
}



// üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Visitas em casa ‚Üí prioriza salgado + m√©dio
if (btnVisitasEmCasa) {
  btnVisitasEmCasa.addEventListener("click", () => {
    if (suggestKind) suggestKind.value = "salgado";
    if (suggestWork) suggestWork.value = "petisco";
    if (suggestFavOnly) suggestFavOnly.checked = false;
    if (suggestAvoidRecent) suggestAvoidRecent.checked = false; // deixa repetir se for conveniente
    generateSuggestionsNow();
  });
}

// üß∫ Tenho esses ingredientes ‚Üí pergunta e filtra por texto
if (btnTenhoIngredientes) {
  btnTenhoIngredientes.addEventListener("click", () => {
    const raw = prompt("Quais ingredientes voc√™ tem? Separe por v√≠rgula.\nEx.: frango, tomate, queijo");
    if (!raw) return;
    const tokens = raw
      .split(",")
      .map(t => t.trim().toLowerCase())
      .filter(Boolean);

    if (!tokens.length) return;

    generateSuggestionsNow({ ingredientsTokens: tokens });
  });
}


  function refreshDaySelectLabels() {
  if (!weekSelect) return;
  const opts = weekSelect.options;
  for (let i = 0; i < opts.length; i++) {
    const wd = weekdayForDayIndex(i);
    opts[i].textContent = `Dia ${i + 1} (${wd})`;
  }
}



    function getMealStatus(dayIndex, mealType) {
    const dayData = state.mealCompliance?.[dayIndex] || {};
    return dayData[mealType] || null; // null = sem registro
  }

  function setMealStatus(dayIndex, mealType, status) {
    if (!state.mealCompliance || typeof state.mealCompliance !== "object") {
      state.mealCompliance = {};
    }
    if (!state.mealCompliance[dayIndex]) {
      state.mealCompliance[dayIndex] = {};
    }

    const current = state.mealCompliance[dayIndex][mealType] || null;
    // clicar de novo no mesmo status limpa
    state.mealCompliance[dayIndex][mealType] =
      current === status ? null : status;

    saveState();
    updateMealStatusButtons();
    renderResumoStats(); // atualiza o resumo se a aba estiver aberta
  }

  function updateMealStatusButtons() {
    const containers = document.querySelectorAll(".meal-status-buttons");
    containers.forEach(container => {
      const dayIdx = Number(container.dataset.dayIndex) || 0;
      const meal = container.dataset.meal;
      const status = getMealStatus(dayIdx, meal);

      container.querySelectorAll(".status-btn").forEach(btn => {
        const myStatus = btn.dataset.status;
        btn.classList.toggle("active", myStatus === status);
      });
    });
  }

function renderResumoStats() {
  const container = document.getElementById("statsResumoContent");
  if (!container) return;

  // Se n√£o tiver plano ainda
  if (!state.weeklyPlans || !state.weeklyPlans.length) {
    container.innerHTML =
      '<p class="small">Monte o card√°pio dos dias para ver o resumo das refei√ß√µes.</p>';
    return;
  }

  // Contadores
  const counts = {
    segui: 0,        // ‚úÖ Dentro do combinado
    ajustei: 0,      // ‚ôªÔ∏è Ajustei
    pulei: 0,        // ‚è≠Ô∏è Pulei
    naoSegui: 0,     // ‚ùå N√£o segui
    semRegistro: 0   // ainda n√£o marquei nada
  };

  // Percorre todos os dias e tipos de refei√ß√£o
  state.weeklyPlans.forEach((wp, dayIdx) => {
    if (!wp) return;
    mealTypes.forEach(meal => {
      const ids = wp[meal] || [];
      // S√≥ conta refei√ß√µes que t√™m pelo menos 1 receita planejada
      if (!ids.length) return;

      const status = getMealStatus(dayIdx, meal);
      if (status && counts.hasOwnProperty(status)) {
        counts[status]++;
      } else {
        counts.semRegistro++;
      }
    });
  });

  const total =
    counts.segui +
    counts.ajustei +
    counts.pulei +
    counts.naoSegui +
    counts.semRegistro;

  if (!total) {
    container.innerHTML =
      '<p class="small">Ainda n√£o h√° refei√ß√µes marcadas como feitas. Use os bot√µes "‚úÖ / ‚ôªÔ∏è / ‚è≠Ô∏è / ‚ùå" na aba Dia.</p>';
    return;
  }

  // Helper para criar uma linha de barra
  function makeRow(label, key) {
    const n = counts[key];
    const pct = total ? Math.round((n / total) * 100) : 0;

    const row = document.createElement("div");
    row.className = "stats-row";

    const labelDiv = document.createElement("div");
    labelDiv.className = "label";
    labelDiv.innerHTML = `<span>${label}</span><span>${n} (${pct}%)</span>`;

    const bar = document.createElement("div");
    bar.className = "stats-bar";

    const fill = document.createElement("div");
    fill.className = "stats-bar-fill " + key; // usa as classes .segui, .ajustei, etc
    fill.style.width = pct + "%";

    bar.appendChild(fill);
    row.appendChild(labelDiv);
    row.appendChild(bar);
    return row;
  }

  // Monta o conte√∫do
  container.innerHTML = "";

  const intro = document.createElement("p");
  intro.className = "small";
  intro.textContent =
    `Total de refei√ß√µes planejadas no ciclo: ${total}. ` +
    ``;
  container.appendChild(intro);

  container.appendChild(makeRow("‚úÖ Dentro do combinado", "segui"));
  container.appendChild(makeRow("‚ôªÔ∏è Ajustei, mas deu certo", "ajustei"));
  container.appendChild(makeRow("‚è≠Ô∏è Puladas", "pulei"));
  container.appendChild(makeRow("‚ùå N√£o segui o combinado", "naoSegui"));
  container.appendChild(makeRow("üìå Sem registro ainda", "semRegistro"));
}


  function renderDayMeals() {
    const wp = state.weeklyPlans[state.selectedWeekIndex];
    dayMealsContainer.innerHTML = "";

    mealTypes.forEach(m => {
      const wrapper = document.createElement("div");
      wrapper.className = "week-list";

      const title = document.createElement("div");
      title.className = "section-title";
      title.textContent = mealLabel(m) + (m === currentMealType ? " (editando)" : "");
      wrapper.appendChild(title);

      const ids = wp && wp[m] ? wp[m] : [];
      if (!ids.length) {
        const p = document.createElement("p");
        p.className = "small";
        p.textContent = "Nenhuma receita selecionada.";
        wrapper.appendChild(p);
      } else {
        const ul = document.createElement("ul");
        ids.forEach(id => {
          const r = getRecipeById(id);
          const li = document.createElement("li");
          const span = document.createElement("span");
          span.textContent = r ? r.name : "(receita removida)";
          const removeBtn = document.createElement("button");
          removeBtn.className = "btn sm danger";
          removeBtn.dataset.action = "remove-day-recipe";
          removeBtn.dataset.meal = m;
          removeBtn.dataset.recipeId = id;
          removeBtn.textContent = "‚ùå";
          li.appendChild(span);
          li.appendChild(removeBtn);
          ul.appendChild(li);
        });
        wrapper.appendChild(ul);
      }

      // üîπ NOVO: linha de status da refei√ß√£o
      const statusRow = document.createElement("div");
      statusRow.className = "meal-status-row";
      statusRow.innerHTML = `
        <span class="small-label"></span>
        <div class="meal-status-buttons"
             data-day-index="${state.selectedWeekIndex}"
             data-meal="${m}">
          <button type="button" class="status-btn" data-status="segui">‚úÖ Segui</button>
          <button type="button" class="status-btn" data-status="ajustei">‚ôªÔ∏è Ajustei</button>
          <button type="button" class="status-btn" data-status="pulei">‚è≠Ô∏è Pulei</button>
          <button type="button" class="status-btn" data-status="naoSegui">‚ùå N√£o segui</button>
        </div>
      `;
      wrapper.appendChild(statusRow);

      dayMealsContainer.appendChild(wrapper);
    });

    // aplica o destaque nos bot√µes
    updateMealStatusButtons();
  }


  function renderWeekView() {
  const d = state.selectedWeekIndex + 1;
  const wd = weekdayForDayIndex(state.selectedWeekIndex); // ex.: "Qui"

  currentMealTitle.textContent = "Op√ß√µes do dia " + d + " (" + wd + ")";

  if (weekdayLabel) {
    weekdayLabel.textContent = wd.toUpperCase();
  }

  renderDayMeals();
  updateSuggestContextText();
  renderResumoStats(); // üîπ atualiza o resumo sempre que o dia for re-renderizado
}


  
  

  if (weekSelect) {
    weekSelect.addEventListener("change", () => {
      state.selectedWeekIndex = Number(weekSelect.value) || 0;
      saveState();
      renderWeekView();
    });
  }

  if (mealSelect) {
    mealSelect.addEventListener("change", () => {
      currentMealType = mealSelect.value;
      renderWeekView();
    });
  }

  if (startWeekdaySelect) {
    startWeekdaySelect.addEventListener("change", () => {
      state.startWeekdayIndex = Number(startWeekdaySelect.value) || 0;
      saveState();
      refreshDaySelectLabels();
      renderWeekView();
    });
  }

  // Bot√£o que abre a Rotina j√° no dia selecionado no Card√°pio
  if (btnOpenRotinaForDay && weekSelect) {
    btnOpenRotinaForDay.addEventListener("click", () => {
      const dayIndex = Number(weekSelect.value) || 0; // 0‚Äì9
      const dayNumber = dayIndex + 1;                  // Dia 1‚Äì10

      // Se o arquivo da Rotina tiver outro nome, troque "rotina.html" aqui
      window.location.href = `rotina.html?dia=${dayNumber}`;
    });
  }


    dayMealsContainer.addEventListener("click", (e) => {
    const btn = e.target.closest("button");
    if (!btn) return;

    // 1) Bot√µes de status da refei√ß√£o
    if (btn.classList.contains("status-btn")) {
      const container = btn.closest(".meal-status-buttons");
      if (!container) return;
      const dayIdx = Number(container.dataset.dayIndex) || 0;
      const meal = container.dataset.meal;
      const status = btn.dataset.status;
      setMealStatus(dayIdx, meal, status);
      return;
    }

    // 2) Bot√£o de remover receita do dia
    if (btn.dataset.action !== "remove-day-recipe") return;
    const meal = btn.dataset.meal;
    const recipeId = btn.dataset.recipeId;
    if (!meal || !recipeId) return;
    if (!confirm("Remover esta receita deste dia?")) return;

    const wp = state.weeklyPlans[state.selectedWeekIndex];
    if (!wp) return;
    wp[meal] = (wp[meal] || []).filter(id => id !== recipeId);
    saveState();
    renderWeekView();
  });


  if (btnClearDay) {
    btnClearDay.addEventListener("click", () => {
      if (!confirm("Tem certeza que deseja limpar todas as op√ß√µes deste dia?")) return;
      const wp = state.weeklyPlans[state.selectedWeekIndex];
      if (!wp) return;
      mealTypes.forEach(m => { wp[m] = []; });
      saveState();
      renderWeekView();
    });
  }

  function openWeekModal() {
    currentModalMode = "editDayMeal";
    modalRecipeToAddId = null;

    const label = mealLabel(currentMealType);
    modalTitle.textContent = "Escolher receitas para " + label;

    const recipesOfType = state.recipes || [];
    modalContent.innerHTML = "";

    if (!recipesOfType.length) {
      const p = document.createElement("p");
      p.className = "small";
      p.textContent = "Voc√™ ainda n√£o cadastrou receitas.";
      modalContent.appendChild(p);
    } else {
      const ul = document.createElement("ul");
      ul.className = "recipe-checkbox-list";

      const wp = state.weeklyPlans[state.selectedWeekIndex] || {
        almoco: [], jantar: [], lanche: [], petisco: []
      };
      const selectedIds = wp[currentMealType] || [];

      recipesOfType.forEach(r => {
        const li = document.createElement("li");
        const id = "chk_" + currentMealType + "_" + r.id;
        const meta = workLevelLabel(r.work);
        li.innerHTML =
          '<label><input type="checkbox" id="' + id + '" data-recipe-id="' + r.id + '"' +
          (selectedIds.includes(r.id) ? " checked" : "") +
          "> " + r.name + ' <span class="small">(' + meta + ')</span></label>';
        ul.appendChild(li);
      });

      modalContent.appendChild(ul);
    }

    modalOverlay.classList.add("active");
  }

  function openAddToDayModal(recipeId, recipeName) {
    currentModalMode = "addSingleRecipe";
    modalRecipeToAddId = recipeId;

    modalTitle.textContent = 'Adicionar "' + (recipeName || "") + '" ao dia';

    const selectedIdx = state.selectedWeekIndex;

    const html = `
  <label for="modalDaySelect">Dia</label>
  <select id="modalDaySelect">
    ${Array.from({ length: 14 }).map((_, i) => {
      const wd = weekdayForDayIndex(i);
      return `<option value="${i}" ${i === selectedIdx ? "selected" : ""}>Dia ${i + 1} (${wd})</option>`;
    }).join("")}
  </select>

  <label for="modalMealSelect">Tipo de refei√ß√£o</label>
  <select id="modalMealSelect">
    <option value="almoco">üçõ Almo√ßo</option>
    <option value="jantar">üçΩ Jantar</option>
    <option value="lanche">‚òï Lanches</option>
    <option value="petisco">üç∑ Petiscos com vinho</option>
  </select>
`;

    modalContent.innerHTML = html;
    modalOverlay.classList.add("active");
  }

  function closeModal() {
    modalOverlay.classList.remove("active");
    currentModalMode = null;
    modalRecipeToAddId = null;
  }

  if (btnEditCurrentMeal) {
    btnEditCurrentMeal.addEventListener("click", () => {
      openWeekModal();
    });
  }

  if (modalCancel) {
    modalCancel.addEventListener("click", () => {
      closeModal();
    });
  }

  if (modalOverlay) {
    modalOverlay.addEventListener("click", (e) => {
      if (e.target === modalOverlay) {
        closeModal();
      }
    });
  }

  if (modalSave) {
    modalSave.addEventListener("click", () => {
      if (currentModalMode === "editDayMeal") {
        if (!state.weeklyPlans || !state.weeklyPlans.length) {
          state.weeklyPlans = createDefaultWeeklyPlans();
        }
        const wp = state.weeklyPlans[state.selectedWeekIndex] || {
          almoco: [], jantar: [], lanche: [], petisco: []
        };
        const inputs = modalContent.querySelectorAll("input[type=checkbox][data-recipe-id]");
        const selected = [];
        inputs.forEach(input => {
          if (input.checked) selected.push(input.dataset.recipeId);
        });
        wp[currentMealType] = selected;
        state.weeklyPlans[state.selectedWeekIndex] = wp;
        saveState();
        renderWeekView();
        closeModal();
      } else if (currentModalMode === "addSingleRecipe" && modalRecipeToAddId) {
        const daySelect = modalContent.querySelector("#modalDaySelect");
        const mealSelectModal = modalContent.querySelector("#modalMealSelect");
        const dayIdx = daySelect ? Number(daySelect.value) || 0 : 0;
        const meal = mealSelectModal ? mealSelectModal.value : "almoco";

        if (!state.weeklyPlans || !state.weeklyPlans.length) {
          state.weeklyPlans = createDefaultWeeklyPlans();
        }
        const wp = state.weeklyPlans[dayIdx] || {
          almoco: [], jantar: [], lanche: [], petisco: []
        };
        if (!Array.isArray(wp[meal])) wp[meal] = [];
        if (!wp[meal].includes(modalRecipeToAddId)) {
          wp[meal].push(modalRecipeToAddId);
        }
        state.weeklyPlans[dayIdx] = wp;
        saveState();

        if (state.selectedWeekIndex === dayIdx) {
          renderWeekView();
        }

        closeModal();
      } else {
        closeModal();
      }
    });
  }

  const btnGerarLista = document.getElementById("btnGerarLista");
  const btnClearShopping = document.getElementById("btnClearShopping");
  const shoppingListContainer = document.getElementById("shoppingListContainer");

  // Linhas que v√£o para a lista de compras:
  // - ignoramos linhas come√ßando com "- " (t√≠tulos/se√ß√µes)
  function isShoppingIngredientLine(txt) {
    if (!txt) return false;
    const t = String(txt).trim();
    if (!t) return false;
    if (t.startsWith("#")) return false; // √© se√ß√£o, n√£o ingrediente
    return true; // todo o resto entra na lista
  }


  function buildBlocksFromWeeklyPlans() {
    const blocks = [];
    const usedIds = new Set();

    state.weeklyPlans.forEach(wp => {
      if (!wp) return;
      mealTypes.forEach(mt => {
        (wp[mt] || []).forEach(id => {
          const r = getRecipeById(id);
          if (!r || !r.ingredients) return;
          if (usedIds.has(id)) return;
          usedIds.add(id);
                    const ingredientsArray = Array.isArray(r.ingredients)
            ? [...r.ingredients]
            : (r.ingredients ? [r.ingredients] : []);

          // filtramos: s√≥ entram as linhas que N√ÉO s√£o t√≠tulo (n√£o come√ßam com "#")
          const shoppingIngredients = ingredientsArray.filter(isShoppingIngredientLine);

          // se por acaso a receita n√£o tiver nenhum ingrediente "compr√°vel", pulamos
          if (!shoppingIngredients.length) return;

          blocks.push({
            id: generateId(),
            type: "recipe",
            recipeId: id,
            name: r.name,
            items: shoppingIngredients.map(txt => ({
              id: generateId(),
              text: txt,
              checked: false
            }))
          });

        });
      });
    });

    return blocks;
  }

  function ensureShoppingBlocksGlobal() {
    const key = "all";
    if (!state.shoppingLists) state.shoppingLists = {};
    const existing = state.shoppingLists[key];
    if (existing && Array.isArray(existing.blocks)) {
      existing.blocks.forEach(b => {
        if (!b.type) b.type = b.recipeId ? "recipe" : "custom";
        if (!Array.isArray(b.items)) b.items = [];
      });
      return existing.blocks;
    }

    const blocks = buildBlocksFromWeeklyPlans();
    state.shoppingLists[key] = { blocks };
    saveState();
    return blocks;
  }

  function renderShoppingList() {
    const blocks = ensureShoppingBlocksGlobal();
    shoppingListContainer.innerHTML = "";

    if (!blocks.length) {
      const p = document.createElement("p");
      p.className = "small";
      p.textContent = "Nenhuma receita selecionada ainda. Escolha receitas na aba ‚ÄúDia‚Äù.";
      shoppingListContainer.appendChild(p);
    } else {
      blocks.forEach(block => {
        const blockEl = document.createElement("div");
        blockEl.className = "shopping-recipe-block";
        blockEl.dataset.blockId = block.id;

        const header = document.createElement("div");
        header.className = "shopping-header";

        const title = document.createElement("div");
        title.className = "section-title";
        title.textContent = block.name || (block.type === "custom" ? "Lista avulsa" : "Receita");

        const headerActions = document.createElement("div");
        headerActions.className = "shopping-header-actions";

        const addItemBtn = document.createElement("button");
        addItemBtn.className = "btn sm";
        addItemBtn.dataset.action = "add-item";
        addItemBtn.textContent = "‚ûï item";

        headerActions.appendChild(addItemBtn);

        if (block.type === "recipe") {
          const finishBtn = document.createElement("button");
          finishBtn.className = "btn sm";
          finishBtn.dataset.action = "finish-list";
          finishBtn.textContent = "Finalizar lista";
          headerActions.appendChild(finishBtn);
        }

        header.appendChild(title);
        header.appendChild(headerActions);

        const ul = document.createElement("ul");
        block.items.forEach(item => {
          const li = document.createElement("li");
          li.dataset.itemId = item.id;

          const label = document.createElement("label");

          const checkbox = document.createElement("input");
          checkbox.type = "checkbox";
          checkbox.dataset.itemId = item.id;
          if (item.checked) checkbox.checked = true;

          const span = document.createElement("span");
          span.contentEditable = "true";
          span.dataset.itemId = item.id;
          span.textContent = item.text;

          label.appendChild(checkbox);
          label.appendChild(span);

          const editBtn = document.createElement("button");
          editBtn.className = "btn sm";
          editBtn.dataset.action = "edit-item";
          editBtn.dataset.itemId = item.id;
          editBtn.textContent = "‚úèÔ∏è";

          const delBtn = document.createElement("button");
          delBtn.className = "btn sm danger";
          delBtn.dataset.action = "delete-item";
          delBtn.dataset.itemId = item.id;
          delBtn.textContent = "üóë";

          li.appendChild(label);
          li.appendChild(editBtn);
          li.appendChild(delBtn);

          ul.appendChild(li);
        });

        blockEl.appendChild(header);
        blockEl.appendChild(ul);
        shoppingListContainer.appendChild(blockEl);
      });
    }

    const extraBlock = document.createElement("div");
    extraBlock.className = "shopping-recipe-block";
    const h = document.createElement("div");
    h.className = "shopping-header";
    const t = document.createElement("div");
    t.className = "section-title";
    t.textContent = "Listas avulsas";
    const actions = document.createElement("div");
    actions.className = "shopping-header-actions";
    const newListBtn = document.createElement("button");
    newListBtn.className = "btn sm";
    newListBtn.dataset.action = "new-custom-list";
    newListBtn.textContent = "‚ûï Nova lista avulsa";
    actions.appendChild(newListBtn);
    h.appendChild(t);
    h.appendChild(actions);
    extraBlock.appendChild(h);
    shoppingListContainer.appendChild(extraBlock);
  }

  if (btnGerarLista) {
    btnGerarLista.addEventListener("click", () => {
      const blocks = buildBlocksFromWeeklyPlans();
      state.shoppingLists["all"] = { blocks };
      saveState();
      renderShoppingList();
    });
  }

  if (btnClearShopping) {
    btnClearShopping.addEventListener("click", () => {
      const key = "all";
      const existing = state.shoppingLists[key];
      if (!existing || !existing.blocks || !existing.blocks.length) {
        alert("N√£o h√° lista gerada ainda.");
        return;
      }
      if (!confirm("Limpar toda a lista geral de compras?")) return;
      delete state.shoppingLists[key];
      saveState();
      shoppingListContainer.innerHTML = '<p class="small">Lista apagada. Gere novamente se precisar.</p>';
    });
  }

  shoppingListContainer.addEventListener("click", (e) => {
    const btn = e.target.closest("button");
    if (!btn) return;
    const action = btn.dataset.action;
    if (!action) return;

    const key = "all";
    const blocks = ensureShoppingBlocksGlobal();

    if (action === "new-custom-list") {
      const countCustom = blocks.filter(b => b.type === "custom").length;
      blocks.push({
        id: generateId(),
        type: "custom",
        recipeId: null,
        name: "Lista avulsa " + (countCustom + 1),
        items: []
      });
      state.shoppingLists[key] = { blocks };
      saveState();
      renderShoppingList();
      return;
    }

    const blockEl = btn.closest(".shopping-recipe-block");
    if (!blockEl) return;
    const blockId = blockEl.dataset.blockId;
    const block = blocks.find(b => b.id === blockId);
    if (!block) return;

    if (action === "add-item") {
      block.items.unshift({
        id: generateId(),
        text: "Novo item",
        checked: false
      });
      state.shoppingLists[key] = { blocks };
      saveState();
      renderShoppingList();
    } else if (action === "finish-list") {
      if (!confirm("Remover esta lista de compras?")) return;
      const idxBlock = blocks.findIndex(b => b.id === blockId);
      if (idxBlock >= 0) {
        blocks.splice(idxBlock, 1);
        state.shoppingLists[key] = { blocks };
        saveState();
        renderShoppingList();
      }
    } else if (action === "delete-item") {
      const itemId = btn.dataset.itemId;
      if (!itemId) return;
      if (!confirm("Excluir este item da lista?")) return;
      block.items = block.items.filter(it => it.id !== itemId);
      state.shoppingLists[key] = { blocks };
      saveState();
      renderShoppingList();
    } else if (action === "edit-item") {
      const itemId = btn.dataset.itemId;
      if (!itemId) return;
      const li = blockEl.querySelector('li[data-item-id="' + itemId + '"]');
      if (!li) return;
      const span = li.querySelector('span[contenteditable="true"]');
      if (!span) return;

      const editing = btn.dataset.mode === "editing";
      if (!editing) {
        btn.dataset.mode = "editing";
        btn.textContent = "OK";
        span.focus();
        const sel = window.getSelection && window.getSelection();
        if (sel && sel.removeAllRanges) {
          const range = document.createRange();
          range.selectNodeContents(span);
          sel.removeAllRanges();
          sel.addRange(range);
        }
      } else {
        btn.dataset.mode = "";
        btn.textContent = "‚úèÔ∏è";
        span.blur();
        saveState();
      }
    }
  });

  shoppingListContainer.addEventListener("input", (e) => {
    const span = e.target.closest('span[contenteditable="true"][data-item-id]');
    if (!span) return;
    const itemId = span.dataset.itemId;
    const blockEl = span.closest(".shopping-recipe-block");
    if (!blockEl) return;
    const blockId = blockEl.dataset.blockId;

    const key = "all";
    const blocks = ensureShoppingBlocksGlobal();
    const block = blocks.find(b => b.id === blockId);
    if (!block) return;
    const item = block.items.find(it => it.id === itemId);
    if (!item) return;

    item.text = span.textContent.trim();
    state.shoppingLists[key] = { blocks };
    saveState();
  });

  shoppingListContainer.addEventListener("change", (e) => {
    const input = e.target.closest('input[type="checkbox"][data-item-id]');
    if (!input) return;
    const itemId = input.dataset.itemId;
    const blockEl = input.closest(".shopping-recipe-block");
    if (!blockEl) return;
    const blockId = blockEl.dataset.blockId;

    const key = "all";
    const blocks = ensureShoppingBlocksGlobal();
    const block = blocks.find(b => b.id === blockId);
    if (!block) return;
    const item = block.items.find(it => it.id === itemId);
    if (!item) return;

    item.checked = !!input.checked;
    state.shoppingLists[key] = { blocks };
    saveState();
  });

  loadState();

  if (!state.weeklyPlans || !state.weeklyPlans.length) {
    state.weeklyPlans = createDefaultWeeklyPlans();
  } else if (state.weeklyPlans.length < 14) {
    const missing = 14 - state.weeklyPlans.length;
    for (let i = 0; i < missing; i++) {
      state.weeklyPlans.push({
        name: "Dia " + (state.weeklyPlans.length + 1),
        almoco: [],
        jantar: [],
        lanche: [],
        petisco: []
      });
    }
  }

  const weekSelectEl = document.getElementById("weekSelect");
  const mealSelectEl = document.getElementById("mealSelect");
  const startWeekdaySelectEl = document.getElementById("startWeekdaySelect");

  if (weekSelectEl) {
    weekSelectEl.value = String(state.selectedWeekIndex);
  }
  if (mealSelectEl) {
    mealSelectEl.value = currentMealType;
  }
  if (startWeekdaySelectEl) {
    startWeekdaySelectEl.value = String(state.startWeekdayIndex || 0);
  }

  refreshDaySelectLabels();
renderRecipesList();
renderWeekView();
updateSuggestContextText();
  renderResumoStats();


})();


  function computeMealStats() {
    const stats = {
      total: 0,
      segui: 0,
      ajustei: 0,
      pulei: 0,
      naoSegui: 0
    };

    const plans = state.weeklyPlans || [];
    if (!plans.length) return stats;

    const mealTypes = ["almoco", "jantar", "lanche", "petisco"];

    plans.forEach((dayPlan, dayIdx) => {
      if (!dayPlan) return;
      mealTypes.forEach(m => {
        const ids = dayPlan[m] || [];
        if (!ids.length) return; // s√≥ conta refei√ß√£o que tem algo planejado

        stats.total++;

        const dayData = state.mealCompliance?.[dayIdx] || {};
        const s = dayData[m];

        if (s === "segui") stats.segui++;
        else if (s === "ajustei") stats.ajustei++;
        else if (s === "pulei") stats.pulei++;
        else if (s === "naoSegui") stats.naoSegui++;
      });
    });

    return stats;
  }

  function renderResumoStats() {
    const container = document.getElementById("statsResumoContent");
    if (!container) return;

    const st = computeMealStats();
    const total = st.total;

    if (!total) {
      container.innerHTML =
        '<p class="small">Planeje pelo menos uma refei√ß√£o (almo√ßo, jantar, lanches ou petiscos) para ver o resumo.</p>';
      return;
    }

    const semRegistro = total - st.segui - st.ajustei - st.pulei - st.naoSegui;

    const pct = (v) => total ? Math.round((v * 100) / total) : 0;

    function row(label, css, value, percent) {
      if (value === 0) {
        return `
          <div class="stats-row">
            <div class="label">
              <span>${label}</span>
              <span>0 (0%)</span>
            </div>
            <div class="stats-bar">
              <div class="stats-bar-fill ${css}" style="width:0%;"></div>
            </div>
          </div>
        `;
      }
      return `
        <div class="stats-row">
          <div class="label">
            <span>${label}</span>
            <span>${value} (${percent}%)</span>
          </div>
          <div class="stats-bar">
            <div class="stats-bar-fill ${css}" style="width:${percent}%;"></div>
          </div>
        </div>
      `;
    }

    container.innerHTML = `
      <p class="small">
        Considerando todas as refei√ß√µes planejadas (almo√ßo, jantar, lanches e petiscos),
        voc√™ tem <strong>${total}</strong> refei√ß√µes registradas no ciclo.
      </p>
      <div class="stats-resumo-section">
        ${row("‚úÖ Segui como planejado", "segui", st.segui, pct(st.segui))}
        ${row("‚ôªÔ∏è Ajustei (varia√ß√£o segura)", "ajustei", st.ajustei, pct(st.ajustei))}
        ${row("‚è≠Ô∏è Pulei", "pulei", st.pulei, pct(st.pulei))}
        ${row("‚ùå N√£o segui (fora do combinado)", "naoSegui", st.naoSegui, pct(st.naoSegui))}
        ${semRegistro > 0
          ? row("üìù Sem registro (nem marcado)", "semRegistro", semRegistro, pct(semRegistro))
          : ""
        }
      </div>
    `;
  }



</script>

<!-- Registro do service worker -->
<script>
if ("serviceWorker" in navigator) {
  window.addEventListener("load", function() {
    navigator.serviceWorker.register("./sw.js").catch(function(err) {
      console.log("Service worker n√£o registrado:", err);
    });
  });
}
</script>

</body>
</html>
